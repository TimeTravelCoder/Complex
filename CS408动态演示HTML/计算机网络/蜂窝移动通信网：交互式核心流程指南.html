<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœ‚çªç§»åŠ¨é€šä¿¡ç½‘äº¤äº’å¼æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Professional Tech (Slate, Sky, Indigo, Emerald) -->
    <!-- 
        Application Structure Plan: The SPA is structured using a vertical, scroll-based layout with distinct, clearly separated sections. This approach was chosen over tabs because the concepts (Mobile IP, Call Routing, Handover) follow a logical learning progression. A user naturally learns about basic data routing (Mobile IP) before moving to more complex voice call routing and handover scenarios. This linear flow guides the user through the material. Each section contains an interactive animation simulator, allowing users to control the step-by-step process, reinforcing their understanding before proceeding to the next topic. This is more effective than a passive report for explaining dynamic processes.
    -->
    <!-- 
        Visualization & Content Choices: 
        1. Report Info: Mobile IP Indirect Routing. Goal: Organize/Show Process. Viz/Method: Interactive, step-by-step animation using HTML/CSS/JS. Justification: Clearly visualizes the abstract concept of IP-in-IP tunneling and the role of home/foreign agents, which is hard to grasp from static diagrams. Interaction: User-controlled "Next Step" buttons. Library: Vanilla JS.
        2. Report Info: Triangle Routing Problem. Goal: Compare/Explain. Viz/Method: Animated side-by-side diagram. Justification: Directly contrasts the inefficient indirect route with a more optimal direct route, making the problemstatement intuitive. Library: Vanilla JS.
        3. Report Info: Cellular Call Routing (HLR/VLR). Goal: Organize/Show Process. Viz/Method: Similar step-by-step animation. Justification: De-mystifies the signaling flow for locating a roaming user, showing how HLR/VLR/MSRN work together. Interaction: User-controlled steps. Library: Vanilla JS.
        4. Report Info: GSM Handover. Goal: Show Process. Viz/Method: Animation showing a user moving between cells. Justification: Visually demonstrates how the Anchor MSC maintains the call connection by re-routing only the final leg of the call path, explaining seamless handover. Interaction: User-triggered animation. Library: Vanilla JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f1f5f9; scroll-behavior: smooth; }
        .content-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px -1px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .interactive-area {
            position: relative;
            width: 100%;
            height: 400px;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .network-cloud {
            position: absolute;
            border: 2px dashed #94a3b8;
            background-color: #eef2ff;
            border-radius: 150px;
        }
        .network-label {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
            color: #4338ca;
            background-color: rgba(255,255,255,0.7);
            padding: 2px 8px;
            border-radius: 99px;
            font-size: 0.8rem;
        }
        .network-node {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.8s ease-in-out;
            z-index: 5;
        }
        .node-icon {
            width: 48px; height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid #94a3b8;
        }
        .node-icon.active { border-color: #3b82f6; transform: scale(1.1); }
        .node-label {
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 4px;
            background: #ffffffaa;
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }
        .packet {
            position: absolute;
            width: 30px;
            height: 20px;
            background-color: #3b82f6;
            border: 2px solid #1e40af;
            border-radius: 4px;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .packet.tunneled {
            background-color: #8b5cf6;
            border: 2px solid #5b21b6;
            transform: scale(1.2);
        }
        .packet.tunneled::after { content: ''; position: absolute; width: 80%; height: 80%; border: 2px dashed white; border-radius: 2px; }
        .path-line {
            position: absolute;
            height: 2px;
            background-color: #cbd5e1;
            transform-origin: 0 0;
            z-index: -1;
            transition: background-color 0.3s;
        }
        .path-line.active { background-color: #3b82f6; }
        .step-desc { min-height: 4rem; }
        .icon-router::before { content: 'â˜·'; font-size: 24px; color: #4f46e5; }
        .icon-server::before { content: 'ğŸ—„ï¸'; font-size: 24px; }
        .icon-phone::before { content: 'ğŸ“±'; font-size: 24px; }
        .icon-pstn::before { content: 'ğŸŒ'; font-size: 24px; }
        .icon-caller::before { content: 'â˜ï¸'; font-size: 24px; }
        .icon-computer::before { content: 'ğŸ’»'; font-size: 24px; }
        .icon-msc::before { content: 'ğŸ¢'; font-size: 24px; }
        .cell-tower { position: absolute; z-index: 1;}
        .cell-tower::before { content: 'ğŸ—¼'; font-size: 40px;}
        .cell-coverage { position: absolute; border-radius: 50%; border: 2px dashed; transition: all 0.5s; z-index: 0;}
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 tracking-tight">èœ‚çªç§»åŠ¨é€šä¿¡ç½‘ï¼šäº¤äº’å¼æ ¸å¿ƒæµç¨‹æŒ‡å—</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">é€šè¿‡å¯è§†åŒ–åŠ¨ç”»ï¼Œæ·±å…¥ç†è§£ç§»åŠ¨IPã€å‘¼å«è·¯ç”±ä¸ç½‘ç»œåˆ‡æ¢èƒŒåçš„å·¥ä½œåŸç†ã€‚</p>
        </header>
        
        <!-- Mobile IP Section -->
        <section id="mobile-ip" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ“ ç§»åŠ¨IP (Mobile IP) ä¸é—´æ¥è·¯ç”±</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                ç§»åŠ¨IPæŠ€æœ¯å…è®¸è®¾å¤‡ï¼ˆç§»åŠ¨ç«™ï¼‰åœ¨ä¸åŒç½‘ç»œé—´æ¼«æ¸¸æ—¶ä¿æŒå…¶å›ºå®šçš„â€œæ°¸ä¹…åœ°å€â€ä¸å˜ï¼Œä»è€Œç»´æŒTCPç­‰ä¸Šå±‚è¿æ¥ä¸ä¸­æ–­ã€‚è¿™æ˜¯é€šè¿‡å½’å±ä»£ç†ã€å¤–åœ°ä»£ç†å’Œâ€œè½¬äº¤åœ°å€â€ååŒå·¥ä½œå®ç°çš„ã€‚ä¸‹é¢çš„åŠ¨ç”»å°†åˆ†æ­¥å±•ç¤ºä¸€ä¸ªæ•°æ®åŒ…å¦‚ä½•é€šè¿‡ **éš§é“æŠ€æœ¯** ä»é€šä¿¡è€…å‘é€åˆ°æ­£åœ¨æ¼«æ¸¸çš„ç§»åŠ¨ç«™ã€‚
            </p>

            <div class="interactive-area" id="mip-diagram">
                <!-- Network Clouds -->
                <div class="network-cloud" style="width: 300px; height: 300px; top: 50%; left: 25%; transform: translate(-50%, -50%);">
                    <span class="network-label">å½’å±ç½‘ç»œ</span>
                </div>
                <div class="network-cloud" style="width: 300px; height: 300px; top: 50%; left: 75%; transform: translate(-50%, -50%); background-color: #e0f2fe;">
                    <span class="network-label" style="color: #0369a1;">è¢«è®¿ç½‘ç»œ</span>
                </div>
                
                <!-- Nodes -->
                <div id="mip-node-b" class="network-node" style="top: 280px; left: 80px;"><span class="node-icon icon-computer"></span><span class="node-label">é€šä¿¡è€… B</span></div>
                <div id="mip-node-ha" class="network-node" style="top: 80px; left: 200px;"><span class="node-icon icon-router"></span><span class="node-label">å½’å±ä»£ç† (HA)</span></div>
                <div id="mip-node-fa" class="network-node" style="top: 100px; left: 550px;"><span class="node-icon icon-router"></span><span class="node-label">å¤–åœ°ä»£ç† (FA)</span></div>
                <div id="mip-node-a" class="network-node" style="top: 300px; left: 620px;"><span class="node-icon icon-phone"></span><span class="node-label">ç§»åŠ¨ç«™ A</span></div>
                
                <!-- Packet -->
                <div id="mip-packet" class="packet"></div>
            </div>

            <div class="mt-6 flex flex-col md:flex-row items-center justify-between bg-slate-50 p-4 rounded-lg">
                <p id="mip-desc" class="step-desc text-slate-700 font-medium text-center md:text-left mb-4 md:mb-0 flex-grow">ç‚¹å‡»â€œå¼€å§‹â€ä»¥å¯åŠ¨é—´æ¥è·¯ç”±è¿‡ç¨‹æ¼”ç¤ºã€‚</p>
                <div class="flex space-x-3">
                    <button id="mip-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">å¼€å§‹ / é‡ç½®</button>
                    <button id="mip-next-btn" disabled class="bg-slate-400 text-white font-bold py-2 px-4 rounded-lg cursor-not-allowed">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
        </section>

        <!-- Call Routing Section -->
        <section id="call-routing" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ“ å‘¼å«è·¯ç”±ä¸ç”¨æˆ·å®šä½</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                å½“æ‚¨æ‹¨æ‰“ä¸€ä¸ªæ­£åœ¨æ¼«æ¸¸çš„æ‰‹æœºæ—¶ï¼Œç½‘ç»œå¦‚ä½•æ‰¾åˆ°å®ƒï¼Ÿè¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºä¸¤ä¸ªå…³é”®æ•°æ®åº“ï¼š**å½’å±ä½ç½®å¯„å­˜å™¨ (HLR)** å’Œ **æ¥è®¿ç”¨æˆ·ä½ç½®å¯„å­˜å™¨ (VLR)**ã€‚HLRæ°¸ä¹…è®°å½•ç”¨æˆ·ä¿¡æ¯ï¼ŒVLRä¸´æ—¶è®°å½•æ¼«æ¸¸ç”¨æˆ·çš„ä½ç½®ã€‚ä¸‹é¢çš„åŠ¨ç”»å°†æ¨¡æ‹Ÿè¿™ä¸€æŸ¥è¯¢è¿‡ç¨‹ã€‚
            </p>

            <div class="interactive-area" id="call-diagram">
                <!-- Nodes -->
                <div id="call-node-caller" class="network-node" style="top: 180px; left: 50px;"><span class="node-icon icon-caller"></span><span class="node-label">å›ºå®šç”µè¯</span></div>
                <div id="call-node-pstn" class="network-node" style="top: 180px; left: 250px;"><span class="node-icon icon-pstn"></span><span class="node-label">å…¬ç”¨ç”µè¯ç½‘</span></div>
                <div id="call-node-hmsc" class="network-node" style="top: 80px; left: 550px;"><span class="node-icon icon-msc"></span><span class="node-label">å½’å± MSC</span></div>
                <div id="call-node-hlr" class="network-node" style="top: 160px; left: 550px;"><span class="node-icon icon-server"></span><span class="node-label">HLR</span></div>
                <div id="call-node-vmsc" class="network-node" style="top: 270px; left: 550px;"><span class="node-icon icon-msc"></span><span class="node-label">è¢«è®¿ MSC</span></div>
                <div id="call-node-vlr" class="network-node" style="top: 350px; left: 550px;"><span class="node-icon icon-server"></span><span class="node-label">VLR</span></div>
                <div id="call-node-mobile" class="network-node" style="top: 310px; left: 850px;"><span class="node-icon icon-phone"></span><span class="node-label">ç§»åŠ¨ç”¨æˆ·</span></div>

                 <!-- Call Path -->
                <div id="call-path" class="packet" style="background-color: #10b981; border-color: #047857;"></div>
            </div>

            <div class="mt-6 flex flex-col md:flex-row items-center justify-between bg-slate-50 p-4 rounded-lg">
                <p id="call-desc" class="step-desc text-slate-700 font-medium text-center md:text-left mb-4 md:mb-0 flex-grow">ç‚¹å‡»â€œå¼€å§‹â€ä»¥æ¨¡æ‹Ÿå›ºå®šç”µè¯å‘¼å«æ¼«æ¸¸æ‰‹æœºçš„è¿‡ç¨‹ã€‚</p>
                <div class="flex space-x-3">
                    <button id="call-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">å¼€å§‹ / é‡ç½®</button>
                    <button id="call-next-btn" disabled class="bg-slate-400 text-white font-bold py-2 px-4 rounded-lg cursor-not-allowed">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
        </section>

        <!-- Handover Section -->
        <section id="handover" class="content-card p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ”„ GSM ä¸­çš„åˆ‡æ¢ (Handover)</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                å½“é€šè¯ä¸­çš„ç”¨æˆ·ä»ä¸€ä¸ªåŸºç«™è¦†ç›–åŒºç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ—¶ï¼Œç½‘ç»œå¿…é¡»æ— ç¼åœ°â€œåˆ‡æ¢â€æœåŠ¡åŸºç«™ä»¥ä¿æŒé€šè¯ä¸ä¸­æ–­ã€‚æ­¤è¿‡ç¨‹çš„å…³é”®æ˜¯**é”šMSC (Anchor MSC)**ï¼Œå®ƒæ˜¯åœ¨å‘¼å«å»ºç«‹æ—¶ç”¨æˆ·é¦–æ¬¡è®¿é—®çš„MSCã€‚åˆ‡æ¢æ—¶ï¼Œåªæœ‰ä»é”šMSCåˆ°æ–°åŸºç«™çš„è·¯å¾„ä¼šè¢«æ›´æ–°ã€‚
            </p>

            <div class="interactive-area" id="handover-diagram">
                <!-- Nodes -->
                <div id="ho-node-hmsc" class="network-node" style="top: 50px; left: 150px;"><span class="node-icon icon-msc"></span><span class="node-label">å½’å± MSC</span></div>
                <div id="ho-node-amsc" class="network-node" style="top: 50px; left: 400px;"><span class="node-icon icon-msc" style="border-color: #f59e0b;"></span><span class="node-label">é”š MSC</span></div>
                <div id="ho-node-msc1" class="network-node" style="top: 200px; left: 250px;"><span class="node-icon icon-msc"></span><span class="node-label">åŸ MSC</span></div>
                <div id="ho-node-msc2" class="network-node" style="top: 200px; left: 550px;"><span class="node-icon icon-msc"></span><span class="node-label">æ–° MSC</span></div>
                <div id="ho-node-mobile" class="network-node" style="top: 320px; left: 250px;"><span class="node-icon icon-phone"></span><span class="node-label">ç§»åŠ¨ç”¨æˆ·</span></div>
                <!-- Cell Towers -->
                <div class="cell-tower" style="top: 280px; left: 230px;"></div>
                <div class="cell-tower" style="top: 280px; left: 530px;"></div>
                <div id="ho-cell1" class="cell-coverage" style="width: 250px; height: 250px; top: 200px; left: 130px; border-color: #22c55e;"></div>
                <div id="ho-cell2" class="cell-coverage" style="width: 250px; height: 250px; top: 200px; left: 430px; border-color: #94a3b8;"></div>
                <!-- Path -->
                <div id="ho-path" class="packet" style="background-color: #10b981; border-color: #047857;"></div>
            </div>

            <div class="mt-6 flex flex-col md:flex-row items-center justify-between bg-slate-50 p-4 rounded-lg">
                <p id="ho-desc" class="step-desc text-slate-700 font-medium text-center md:text-left mb-4 md:mb-0 flex-grow">ç‚¹å‡»â€œå¼€å§‹åˆ‡æ¢â€è§‚å¯Ÿç”¨æˆ·ç§»åŠ¨å’Œå‘¼å«è·¯å¾„çš„æ”¹å˜ã€‚</p>
                <div class="flex space-x-3">
                    <button id="ho-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">å¼€å§‹åˆ‡æ¢</button>
                    <button id="ho-reset-btn" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">é‡ç½®</button>
                </div>
            </div>
        </section>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Helper Functions ---
        function getElementCenter(element, container) {
            const elRect = element.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            const x = elRect.left + elRect.width / 2 - containerRect.left;
            const y = elRect.top + elRect.height / 2 - containerRect.top;
            return { x: x, y: y };
        }

        function movePacket(packet, fromEl, toEl, duration = 1.5, onEnd = () => {}) {
            const startPos = getElementCenter(fromEl, packet.parentElement);
            const endPos = getElementCenter(toEl, packet.parentElement);
            
            packet.style.transition = 'none';
            packet.style.top = `${startPos.y - 10}px`;
            packet.style.left = `${startPos.x - 15}px`;
            packet.style.opacity = '1';
            
            setTimeout(() => {
                packet.style.transition = `all ${duration}s cubic-bezier(0.4, 0, 0.2, 1)`;
                packet.style.top = `${endPos.y - 10}px`;
                packet.style.left = `${endPos.x - 15}px`;
            }, 50);

            setTimeout(() => {
                onEnd();
            }, duration * 1000 + 100);
        }
        
        function highlightNode(node, duration = 2000) {
            if (node) {
                const icon = node.querySelector('.node-icon');
                icon.classList.add('active');
                setTimeout(() => icon.classList.remove('active'), duration);
            }
        }

        // --- Mobile IP Animation ---
        const mipDiagram = document.getElementById('mip-diagram');
        const mipPacket = document.getElementById('mip-packet');
        const mipBtnStart = document.getElementById('mip-start-btn');
        const mipBtnNext = document.getElementById('mip-next-btn');
        const mipDesc = document.getElementById('mip-desc');
        const mipNodes = {
            b: document.getElementById('mip-node-b'),
            ha: document.getElementById('mip-node-ha'),
            fa: document.getElementById('mip-node-fa'),
            a: document.getElementById('mip-node-a'),
        };
        let mipStep = 0;

        const mipSteps = [
            { desc: 'ç‚¹å‡»â€œå¼€å§‹â€ä»¥å¯åŠ¨é—´æ¥è·¯ç”±è¿‡ç¨‹æ¼”ç¤ºã€‚' },
            {
                desc: '1. é€šä¿¡è€… B å‘ç§»åŠ¨ç«™ A çš„æ°¸ä¹…åœ°å€å‘é€æ•°æ®åŒ…ã€‚æ•°æ®åŒ…é¦–å…ˆè¢«è·¯ç”±åˆ°Açš„å½’å±ç½‘ç»œã€‚',
                action: () => {
                    highlightNode(mipNodes.b);
                    movePacket(mipPacket, mipNodes.b, mipNodes.ha, 1.5, () => {
                        highlightNode(mipNodes.ha);
                        mipPacket.style.opacity = '0';
                    });
                }
            },
            {
                desc: '2. å½’å±ä»£ç†(HA)æˆªè·æ•°æ®åŒ…ï¼Œå¹¶æŸ¥è¯¢åˆ° A çš„è½¬äº¤åœ°å€ã€‚HA å°†åŸå§‹æ•°æ®åŒ…å°è£…(IP-in-IPéš§é“)ï¼Œå‘å¾€è¯¥è½¬äº¤åœ°å€ã€‚',
                action: () => {
                    mipPacket.classList.add('tunneled');
                    highlightNode(mipNodes.ha);
                    movePacket(mipPacket, mipNodes.ha, mipNodes.fa, 1.5, () => {
                        highlightNode(mipNodes.fa);
                    });
                }
            },
            {
                desc: '3. å¤–åœ°ä»£ç†(FA)æ”¶åˆ°å°è£…çš„æ•°æ®åŒ…ï¼Œå°†å…¶è§£å°ï¼Œæ¢å¤ä¸ºåŸå§‹æ•°æ®åŒ…ã€‚',
                action: () => {
                    mipPacket.classList.remove('tunneled');
                    mipPacket.style.transform = 'scale(1.2)';
                    setTimeout(() => { mipPacket.style.transform = 'scale(1)'; }, 300);
                }
            },
            {
                desc: '4. FA å°†åŸå§‹æ•°æ®åŒ…è½¬å‘ç»™å…¶æœåŠ¡èŒƒå›´å†…çš„ç§»åŠ¨ç«™ Aã€‚é€šä¿¡å®Œæˆã€‚',
                action: () => {
                     movePacket(mipPacket, mipNodes.fa, mipNodes.a, 1.5, () => {
                        highlightNode(mipNodes.a);
                    });
                }
            },
            { desc: 'æ¼”ç¤ºç»“æŸã€‚ç‚¹å‡»â€œå¼€å§‹/é‡ç½®â€å¯å†æ¬¡è§‚çœ‹ã€‚' }
        ];

        function mipReset() {
            mipStep = 0;
            mipDesc.textContent = mipSteps[0].desc;
            mipBtnNext.disabled = true;
            mipBtnNext.classList.add('bg-slate-400', 'cursor-not-allowed');
            mipBtnNext.classList.remove('bg-sky-600', 'hover:bg-sky-700');
            mipPacket.style.opacity = '0';
            mipPacket.classList.remove('tunneled');
        }

        mipBtnStart.addEventListener('click', () => {
            mipReset();
            mipStep = 1;
            mipDesc.textContent = mipSteps[mipStep].desc;
            mipBtnNext.disabled = false;
            mipBtnNext.classList.remove('bg-slate-400', 'cursor-not-allowed');
            mipBtnNext.classList.add('bg-sky-600', 'hover:bg-sky-700');
            const startPos = getElementCenter(mipNodes.b, mipDiagram);
            mipPacket.style.top = `${startPos.y - 10}px`;
            mipPacket.style.left = `${startPos.x - 15}px`;
        });

        mipBtnNext.addEventListener('click', () => {
            if (mipStep > 0 && mipStep < mipSteps.length - 1) {
                mipSteps[mipStep].action();
                mipStep++;
                mipDesc.textContent = mipSteps[mipStep].desc;
                if (mipStep === mipSteps.length - 1) {
                    mipBtnNext.disabled = true;
                    mipBtnNext.classList.add('bg-slate-400', 'cursor-not-allowed');
                    mipBtnNext.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                }
            }
        });
        
        // --- Call Routing Animation ---
        const callDiagram = document.getElementById('call-diagram');
        const callPath = document.getElementById('call-path');
        const callBtnStart = document.getElementById('call-start-btn');
        const callBtnNext = document.getElementById('call-next-btn');
        const callDesc = document.getElementById('call-desc');
        const callNodes = {
            caller: document.getElementById('call-node-caller'),
            pstn: document.getElementById('call-node-pstn'),
            hmsc: document.getElementById('call-node-hmsc'),
            hlr: document.getElementById('call-node-hlr'),
            vmsc: document.getElementById('call-node-vmsc'),
            vlr: document.getElementById('call-node-vlr'),
            mobile: document.getElementById('call-node-mobile'),
        };
        let callStep = 0;

        const callSteps = [
            { desc: 'ç‚¹å‡»â€œå¼€å§‹â€ä»¥æ¨¡æ‹Ÿå›ºå®šç”µè¯å‘¼å«æ¼«æ¸¸æ‰‹æœºçš„è¿‡ç¨‹ã€‚' },
            {
                desc: '1. å‘¼å«è¯·æ±‚ä»å›ºå®šç”µè¯å‘å‡ºï¼Œç»å…¬ç”¨ç”µè¯ç½‘(PSTN)æ ¹æ®æ‰‹æœºå·ç ï¼Œè·¯ç”±åˆ°ç”¨æˆ·çš„å½’å±ç§»åŠ¨äº¤æ¢ä¸­å¿ƒ(Home MSC)ã€‚',
                action: () => {
                    highlightNode(callNodes.caller);
                    movePacket(callPath, callNodes.caller, callNodes.hmsc, 1.5, () => {
                        highlightNode(callNodes.hmsc);
                        callPath.style.opacity = '0';
                    });
                }
            },
            {
                desc: '2. å½’å±MSCå‘å½’å±ä½ç½®å¯„å­˜å™¨(HLR)æŸ¥è¯¢ç”¨æˆ·å½“å‰ä½ç½®ã€‚',
                action: () => {
                    movePacket(callPath, callNodes.hmsc, callNodes.hlr, 0.8, () => {
                        highlightNode(callNodes.hlr);
                        callPath.style.opacity = '0';
                    });
                }
            },
            {
                desc: '3. HLRä¸­è®°å½•äº†ç”¨æˆ·çš„æ¼«æ¸¸å·(MSRN)ã€‚HLRå°†æ­¤æ¼«æ¸¸å·è¿”å›ç»™å½’å±MSCã€‚',
                action: () => {
                    movePacket(callPath, callNodes.hlr, callNodes.hmsc, 0.8, () => {
                        highlightNode(callNodes.hmsc);
                        callPath.style.opacity = '0';
                    });
                }
            },
            {
                desc: '4. å½’å±MSCä½¿ç”¨æ¼«æ¸¸å·ï¼Œå°†å‘¼å«çš„ç¬¬äºŒæ®µè·¯ç”±åˆ°è¢«è®¿ç½‘ç»œçš„MSC (Visited MSC)ã€‚',
                action: () => {
                    movePacket(callPath, callNodes.hmsc, callNodes.vmsc, 1.5, () => {
                        highlightNode(callNodes.vmsc);
                        callPath.style.opacity = '0';
                    });
                }
            },
            {
                desc: '5. è¢«è®¿MSCé€šè¿‡å…¶æ§åˆ¶çš„åŸºç«™ï¼Œæœ€ç»ˆå°†å‘¼å«é€è¾¾ç§»åŠ¨ç”¨æˆ·ã€‚å‘¼å«å»ºç«‹ã€‚',
                action: () => {
                    movePacket(callPath, callNodes.vmsc, callNodes.mobile, 1.5, () => {
                        highlightNode(callNodes.mobile);
                    });
                }
            },
            { desc: 'æ¼”ç¤ºç»“æŸã€‚ç‚¹å‡»â€œå¼€å§‹/é‡ç½®â€å¯å†æ¬¡è§‚çœ‹ã€‚' }
        ];

        function callReset() {
            callStep = 0;
            callDesc.textContent = callSteps[0].desc;
            callBtnNext.disabled = true;
            callBtnNext.classList.add('bg-slate-400', 'cursor-not-allowed');
            callBtnNext.classList.remove('bg-sky-600', 'hover:bg-sky-700');
            callPath.style.opacity = '0';
        }

        callBtnStart.addEventListener('click', () => {
            callReset();
            callStep = 1;
            callDesc.textContent = callSteps[callStep].desc;
            callBtnNext.disabled = false;
            callBtnNext.classList.remove('bg-slate-400', 'cursor-not-allowed');
            callBtnNext.classList.add('bg-sky-600', 'hover:bg-sky-700');
            const startPos = getElementCenter(callNodes.caller, callDiagram);
            callPath.style.top = `${startPos.y - 10}px`;
            callPath.style.left = `${startPos.x - 15}px`;
        });

        callBtnNext.addEventListener('click', () => {
            if (callStep > 0 && callStep < callSteps.length - 1) {
                callSteps[callStep].action();
                callStep++;
                callDesc.textContent = callSteps[callStep].desc;
                if (callStep === callSteps.length - 1) {
                    callBtnNext.disabled = true;
                    callBtnNext.classList.add('bg-slate-400', 'cursor-not-allowed');
                    callBtnNext.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                }
            }
        });

        // --- Handover Animation ---
        const hoDiagram = document.getElementById('handover-diagram');
        const hoBtnStart = document.getElementById('ho-start-btn');
        const hoBtnReset = document.getElementById('ho-reset-btn');
        const hoDesc = document.getElementById('ho-desc');
        const hoMobile = document.getElementById('ho-node-mobile');
        const hoCell1 = document.getElementById('ho-cell1');
        const hoCell2 = document.getElementById('ho-cell2');
        let hoState = 'initial';

        function hoReset() {
            hoMobile.style.left = '250px';
            hoCell1.style.borderColor = '#22c55e';
            hoCell2.style.borderColor = '#94a3b8';
            hoDesc.textContent = 'ç‚¹å‡»â€œå¼€å§‹åˆ‡æ¢â€è§‚å¯Ÿç”¨æˆ·ç§»åŠ¨å’Œå‘¼å«è·¯å¾„çš„æ”¹å˜ã€‚';
            hoState = 'initial';
            hoBtnStart.disabled = false;
        }

        hoBtnStart.addEventListener('click', () => {
            if (hoState !== 'initial') return;
            hoState = 'moving';
            hoBtnStart.disabled = true;
            hoDesc.textContent = 'ç”¨æˆ·æ­£åœ¨å‘å³ç§»åŠ¨ï¼Œå³å°†ç¦»å¼€åŸåŸºç«™è¦†ç›–åŒº...';
            hoMobile.style.left = '550px';
            setTimeout(() => {
                hoDesc.textContent = 'ä¿¡å·å‡å¼±ï¼Œç½‘ç»œå†³å®šåˆ‡æ¢ï¼é”šMSCå°†å‘¼å«è·¯å¾„é‡å®šå‘åˆ°æ–°MSCã€‚';
                hoCell1.style.borderColor = '#94a3b8';
                hoCell2.style.borderColor = '#22c55e';
                hoState = 'finished';
                hoBtnStart.disabled = false;
            }, 1500);
        });

        hoBtnReset.addEventListener('click', hoReset);

        // Initialize all
        mipReset();
        callReset();
        hoReset();
    });
    </script>

</body>
</html>
