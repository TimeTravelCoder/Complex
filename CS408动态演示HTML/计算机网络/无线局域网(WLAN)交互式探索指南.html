<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ— çº¿å±€åŸŸç½‘(WLAN)äº¤äº’å¼æ¢ç´¢æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate & Sky -->
    <!-- 
        Application Structure Plan: æœ¬åº”ç”¨è®¾è®¡ä¸ºå•é¡µå‚ç›´æ»šåŠ¨å¼å¸ƒå±€ã€‚æ­¤ç»“æ„æ ¹æ®å­¦ä¹ çš„é€»è¾‘é€’è¿›å…³ç³»è¿›è¡Œç»„ç»‡ï¼šä»å®è§‚çš„â€œç½‘ç»œæ¶æ„â€å…¥æ‰‹ï¼Œæ¥ç€æ¢è®¨æ— çº¿ä¿¡é“çš„â€œæ ¸å¿ƒæŒ‘æˆ˜â€ï¼ˆéšè”½ç«™/æš´éœ²ç«™é—®é¢˜ï¼‰ï¼Œç„¶åæ·±å…¥å‰–æä¸ºè§£å†³è¿™äº›æŒ‘æˆ˜è€Œè®¾è®¡çš„â€œCSMA/CAåè®®â€å’Œâ€œRTS/CTSæœºåˆ¶â€ï¼Œå†è§£æ„å…·ä½“çš„â€œMACå¸§æ ¼å¼â€ï¼Œæœ€åä»¥â€œç‰©ç†å±‚æ ‡å‡†â€å¯¹æ¯”æ”¶å°¾ã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¡ç‰‡å¼æ¨¡å—ï¼ŒåŒ…å«ç®€ä»‹ã€äº¤äº’å¼æ¼”ç¤ºå’Œå…³é”®ç‚¹æ€»ç»“ï¼Œå¼•å¯¼ç”¨æˆ·ç”±æµ…å…¥æ·±åœ°æ„å»ºçŸ¥è¯†ä½“ç³»ã€‚è¿™ç§ç»“æ„æ¯”ä¼ ç»Ÿçš„æ–‡æ¡£æˆ–æ ‡ç­¾é¡µå¼å¸ƒå±€æ›´ç¬¦åˆå­¦ä¹ å’Œæ¢ç´¢çš„è‡ªç„¶æµç¨‹ã€‚
    -->
    <!-- 
        Visualization & Content Choices: 
        1. Report Info: WLANæ¶æ„ (BSS/ESS/Ad-hoc)ã€‚Goal: ç»„ç»‡ä¸å‘ŠçŸ¥ã€‚Viz/Method: ä½¿ç”¨HTML/CSSæ„å»ºçš„åŠ¨æ€å›¾è§£ï¼Œç”¨æˆ·ç‚¹å‡»ä¸åŒæ¶æ„æŒ‰é’®å¯åˆ‡æ¢è§†å›¾ã€‚Justification: ç›´è§‚å±•ç¤ºä¸åŒæ¶æ„çš„ç»„æˆå’Œè¿æ¥å…³ç³»ï¼Œæ¯”é™æ€å›¾ç‰‡æ›´æ¸…æ™°ã€‚Interaction: ç‚¹å‡»åˆ‡æ¢ã€‚Library: Vanilla JSã€‚
        2. Report Info: éšè”½ç«™/æš´éœ²ç«™é—®é¢˜ã€‚Goal: è§£é‡ŠåŸå› ã€‚Viz/Method: ç®€çº¦çš„CSSåŠ¨ç”»æ¼”ç¤ºã€‚Justification: åŠ¨æ€å±•ç¤ºä¿¡å·èŒƒå›´å’Œç¢°æ’/ç­‰å¾…çš„å‘ç”Ÿè¿‡ç¨‹ï¼Œè®©æŠ½è±¡é—®é¢˜å…·ä½“åŒ–ã€‚Interaction: è‡ªåŠ¨æ’­æ”¾åŠ¨ç”»ã€‚Library: CSS Animationsã€‚
        3. Report Info: CSMA/CAåè®®ã€‚Goal: æ¼”ç¤ºè¿‡ç¨‹ã€‚Viz/Method: äº¤äº’å¼æ—¶é—´è½´æ¨¡æ‹Ÿå™¨ã€‚Justification: è¿™æ˜¯å…¨ç¯‡æ ¸å¿ƒï¼Œé€šè¿‡æ¨¡æ‹Ÿå¤šç«™ç‚¹äº‰ç”¨ä¿¡é“ã€é€€é¿ã€å†»ç»“è®¡æ—¶å™¨çš„è¿‡ç¨‹ï¼Œå°†å¤æ‚çš„åè®®è§„åˆ™è½¬åŒ–ä¸ºå¯è§‚å¯Ÿçš„äº‹ä»¶åºåˆ—ã€‚Interaction: ç”¨æˆ·å¯åŠ¨æ¨¡æ‹Ÿï¼Œè§‚å¯Ÿæ—¥å¿—ã€‚Library: Vanilla JSã€‚
        4. Report Info: RTS/CTSæ¡æ‰‹ã€‚Goal: æ¼”ç¤ºè¿‡ç¨‹ã€‚Viz/Method: åˆ†æ­¥å¼åŠ¨ç”»ã€‚Justification: æ¸…æ™°å±•ç¤ºRTS/CTSå¦‚ä½•é€šè¿‡è®¾ç½®NAVæ¥â€œé¢„çº¦â€ä¿¡é“å¹¶è§£å†³éšè”½ç«™é—®é¢˜ã€‚Interaction: ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ§åˆ¶æ­¥éª¤ã€‚Library: Vanilla JSã€‚
        5. Report Info: 802.11 MACå¸§åœ°å€ã€‚Goal: è§£é‡Šä¸æ¯”è¾ƒã€‚Viz/Method: äº¤äº’å¼å¸§ç»“æ„åˆ†è§£å›¾ã€‚Justification: è¿™æ˜¯ç†è§£WLANæ•°æ®æµçš„å…³é”®éš¾ç‚¹ã€‚é€šè¿‡è®©ç”¨æˆ·é€‰æ‹©ä¸åŒåœºæ™¯ï¼ˆå¦‚ç«™åˆ°APï¼‰ï¼ŒåŠ¨æ€æ›´æ–°å¸§å†…åœ°å€å­—æ®µçš„å«ä¹‰ï¼Œå°†å¤æ‚çš„åœ°å€é€»è¾‘æ¸…æ™°å‘ˆç°ã€‚Interaction: ä¸‹æ‹‰èœå•é€‰æ‹©åœºæ™¯ã€‚Library: Vanilla JSã€‚
        6. Report Info: 802.11ç‰©ç†å±‚æ ‡å‡†ã€‚Goal: æ¯”è¾ƒä¸å‘ŠçŸ¥ã€‚Viz/Method: å“åº”å¼æ¡å½¢å›¾ã€‚Justification: ç›´è§‚å¯¹æ¯”å„æ ‡å‡†åœ¨é€Ÿç‡ä¸Šçš„å·®å¼‚ã€‚Interaction: æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚Library: Chart.jsã€‚
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f1f5f9; scroll-behavior: smooth; }
        .content-card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .interactive-area { position: relative; width: 100%; min-height: 350px; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden; }
        .station-node {
            position: absolute;
            display: flex; flex-direction: column; align-items: center;
            transition: all 0.5s ease-in-out;
            z-index: 10;
        }
        .station-icon { font-size: 2.5rem; line-height: 1; }
        .station-label { font-size: 0.75rem; font-weight: 500; background: rgba(255,255,255,0.8); backdrop-filter: blur(2px); padding: 2px 6px; border-radius: 4px; margin-top: 4px; white-space: nowrap; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .packet {
            position: absolute;
            width: 24px; height: 24px;
            border-radius: 50%;
            opacity: 0;
            transition: all 1.2s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            font-weight: bold;
            color: white;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size: 10px;
            z-index: 20;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .timeline { position: relative; width: 100%; height: 24px; background-color: #e2e8f0; border-radius: 12px; margin-top: 10px; }
        .time-block { position: absolute; height: 100%; border-radius: 12px; transition: width 0.3s ease-out; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; }
        .chart-container { position: relative; height: 400px; width: 100%; max-w-4xl; margin: auto; }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 tracking-tight">æ— çº¿å±€åŸŸç½‘(WLAN)äº¤äº’å¼æ¢ç´¢æŒ‡å—</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">ä»ç½‘ç»œæ¶æ„åˆ°å¤æ‚çš„MACå±‚åè®®ï¼Œé€šè¿‡å¯è§†åŒ–ä¸äº¤äº’ï¼Œæ·±å…¥ç†è§£Wi-FièƒŒåçš„æ ¸å¿ƒæŠ€æœ¯ã€‚</p>
        </header>

        <!-- WLAN Architectures Section -->
        <section id="architectures" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ¢ 1. WLAN ä½“ç³»ç»“æ„</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                æ— çº¿å±€åŸŸç½‘æœ‰ä¸¤ç§ä¸»è¦çš„éƒ¨ç½²æ¨¡å¼ï¼šæœ€å¸¸è§çš„æ˜¯ä¾èµ–<strong>æ¥å…¥ç‚¹(AP)</strong>çš„<strong>åŸºç¡€è®¾æ–½æ¨¡å¼</strong>ï¼Œå®ƒå¯ä»¥æ„å»ºä»å•ä¸ª<strong>åŸºæœ¬æœåŠ¡é›†(BSS)</strong>åˆ°è·¨æ¥¼å®‡çš„<strong>æ‰©å±•æœåŠ¡é›†(ESS)</strong>ï¼›å¦ä¸€ç§æ˜¯æ— éœ€APï¼Œç”±è®¾å¤‡ä¹‹é—´ç›´æ¥è¿æ¥å½¢æˆçš„<strong>è‡ªç»„(Ad hoc)ç½‘ç»œ</strong>ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ‡æ¢å¹¶æŸ¥çœ‹ä¸åŒçš„ç½‘ç»œç»“æ„ã€‚
            </p>
            <div class="flex justify-center space-x-4 mb-6">
                <button onclick="drawArchitecture('bss')" class="arch-btn bg-sky-600 text-white font-bold py-2 px-5 rounded-lg shadow-sm transition-all hover:scale-105 hover:bg-sky-700">BSS</button>
                <button onclick="drawArchitecture('ess')" class="arch-btn bg-slate-500 text-white font-bold py-2 px-5 rounded-lg shadow-sm transition-all hover:scale-105 hover:bg-slate-600">ESS</button>
                <button onclick="drawArchitecture('adhoc')" class="arch-btn bg-slate-500 text-white font-bold py-2 px-5 rounded-lg shadow-sm transition-all hover:scale-105 hover:bg-slate-600">Ad hoc</button>
            </div>
            <div id="arch-diagram" class="interactive-area flex items-center justify-center p-4 transition-all duration-500"></div>
        </section>
        
        <!-- CSMA/CA Simulator Section -->
        <section id="csmaca" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸš¦ 2. CSMA/CA ç¢°æ’é¿å…æœºåˆ¶æ¨¡æ‹Ÿå™¨</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
               ä¸ºäº†é¿å…ç¢°æ’ï¼Œ802.11é‡‡ç”¨CSMA/CAåè®®ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯â€œå…ˆå¬å†è¯´ï¼Œéšæœºé€€é¿â€ã€‚å½“ä¿¡é“ç”±å¿™å˜é—²æ—¶ï¼Œæ‰€æœ‰æƒ³å‘é€çš„ç«™ç‚¹éƒ½å¿…é¡»ç­‰å¾…ä¸€ä¸ªéšæœºæ—¶é—´ã€‚æ­¤æ¨¡æ‹Ÿå™¨å°†å±•ç¤ºå¤šä¸ªç«™ç‚¹å¦‚ä½•é€šè¿‡æ­¤æœºåˆ¶äº‰ç”¨ä¿¡é“ã€‚
            </p>
            <div id="csmaca-sim-area" class="p-4 bg-slate-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                     <div class="flex flex-wrap gap-x-4 gap-y-1 items-center text-xs">
                        <span class="flex items-center"><span class="w-3 h-3 rounded-sm bg-blue-500 mr-1.5"></span>DIFS</span>
                        <span class="flex items-center"><span class="w-3 h-3 rounded-sm bg-yellow-400 mr-1.5"></span>é€€é¿</span>
                        <span class="flex items-center"><span class="w-3 h-3 rounded-sm bg-green-500 mr-1.5"></span>å‘é€</span>
                         <span class="flex items-center"><span class="w-3 h-3 rounded-sm bg-indigo-400 mr-1.5"></span>SIFS</span>
                        <span class="flex items-center"><span class="w-3 h-3 rounded-sm bg-pink-500 mr-1.5"></span>ACK</span>
                    </div>
                    <button id="csmaca-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">å¯åŠ¨æ¨¡æ‹Ÿ</button>
                </div>
                <div id="csmaca-timelines" class="space-y-3"></div>
                <div id="csmaca-log" class="mt-4 p-3 h-32 bg-gray-800 text-white font-mono text-xs rounded-md overflow-y-auto"></div>
            </div>
        </section>
        
        <!-- RTS/CTS Section -->
        <section id="rtscts" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ¤ 3. é¢„çº¦ä¿¡é“: RTS/CTS æ¡æ‰‹</h2>
             <p class="text-slate-600 mb-6 leading-relaxed">
               ä¸ºäº†å½»åº•è§£å†³éšè”½ç«™é—®é¢˜ï¼ŒWLANå¼•å…¥äº†å¯é€‰çš„RTS/CTSæœºåˆ¶ã€‚å‘é€é•¿æ•°æ®å‰ï¼Œæºç«™å…ˆç”¨ä¸€ä¸ªçŸ­çš„<strong>è¯·æ±‚å‘é€(RTS)</strong>å¸§æ¥â€œé¢„çº¦â€ä¿¡é“ã€‚ç›®çš„ç«™å›å¤ä¸€ä¸ª<strong>å…è®¸å‘é€(CTS)</strong>å¸§ã€‚ç½‘ç»œä¸­æ‰€æœ‰å¬åˆ°ä»»ä¸€å¸§çš„ç«™ç‚¹ï¼Œéƒ½ä¼šåœ¨æŒ‡å®šæ—¶é—´å†…ä¿æŒé™é»˜ï¼Œä»è€Œä¸ºæ•°æ®ä¼ è¾“æ¸…ç©ºä¿¡é“ã€‚
            </p>
            <div class="interactive-area" id="rts-cts-diagram"></div>
            <div class="mt-6 flex flex-col md:flex-row items-center justify-between bg-slate-50 p-4 rounded-lg">
                 <p id="rts-cts-desc" class="flex-grow text-slate-700 font-medium text-center md:text-left mb-4 md:mb-0">ç‚¹å‡»â€œå¼€å§‹â€æ¼”ç¤ºRTS/CTSæ¡æ‰‹è¿‡ç¨‹ã€‚</p>
                <div class="flex space-x-3">
                    <button id="rts-cts-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">å¼€å§‹ / é‡ç½®</button>
                    <button id="rts-cts-next-btn" disabled class="bg-slate-400 text-white font-bold py-2 px-4 rounded-lg cursor-not-allowed">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
        </section>

        <!-- MAC Frame Section -->
        <section id="mac-frame" class="content-card mb-12 p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ“¦ 4. æ·±å…¥ 802.11 MAC å¸§</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
               802.11æ•°æ®å¸§çš„ç»“æ„æ¯”ä»¥å¤ªç½‘å¤æ‚å¾—å¤šï¼Œå…¶æ ¸å¿ƒæ˜¯4ä¸ªåœ°å€å­—æ®µã€‚åœ°å€çš„å«ä¹‰å¹¶éå›ºå®šï¼Œè€Œæ˜¯ç”±â€œTo DSâ€å’Œâ€œFrom DSâ€ä¸¤ä¸ªæ ‡å¿—ä½å†³å®šã€‚é€‰æ‹©ä¸€ä¸ªé€šä¿¡åœºæ™¯ï¼Œè§‚å¯Ÿåœ°å€å­—æ®µå¦‚ä½•åŠ¨æ€å˜åŒ–ã€‚
            </p>
            <div class="p-4 bg-slate-50 rounded-lg">
                <div class="mb-4">
                    <label for="scenario-select" class="block text-sm font-medium text-gray-700 mb-1">é€‰æ‹©é€šä¿¡åœºæ™¯:</label>
                    <select id="scenario-select" class="w-full md:w-1/2 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="sta-to-ap">ç§»åŠ¨ç«™ -> AP -> æœ‰çº¿ç½‘ç»œ</option>
                        <option value="ap-to-sta">æœ‰çº¿ç½‘ç»œ -> AP -> ç§»åŠ¨ç«™</option>
                        <option value="sta-to-sta">ç§»åŠ¨ç«™A -> AP -> ç§»åŠ¨ç«™B</option>
                    </select>
                </div>
                <div id="frame-container" class="bg-white p-4 rounded shadow-inner overflow-x-auto"></div>
            </div>
        </section>
        
        <!-- Standards Chart Section -->
        <section id="standards" class="content-card p-6 md:p-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">ğŸ“Š 5. 802.11 ç‰©ç†å±‚æ ‡å‡†æ¼”è¿›</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                ä»æœ€åˆçš„802.11båˆ°ç°åœ¨çš„Wi-Fi 6(802.11ax)ï¼ŒWLANçš„é€Ÿåº¦å’Œæ•ˆç‡å®ç°äº†å·¨å¤§é£è·ƒã€‚è¿™ä¸»è¦å¾—ç›Šäºç‰©ç†å±‚æŠ€æœ¯çš„ä¸æ–­é©æ–°ï¼Œå¦‚OFDMå’ŒMIMOã€‚ä¸‹å›¾å±•ç¤ºäº†éƒ¨åˆ†ä¸»æµæ ‡å‡†çš„æœ€å¤§ç†è®ºé€Ÿç‡ã€‚
            </p>
            <div class="chart-container">
                <canvas id="standards-chart"></canvas>
            </div>
        </section>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // Helper functions moved to a shared scope
        function createStationNode(container, label, icon, top, left) {
            const node = document.createElement('div');
            node.className = 'station-node';
            node.style.top = top;
            node.style.left = left;
            node.style.transform = 'translate(-50%, -50%)';
            node.innerHTML = `<span class="station-icon">${icon}</span><span class="station-label">${label}</span>`;
            container.appendChild(node);
            return node;
        }

        function createPacket(container, bgColor, text) {
             const packet = document.createElement('div');
             packet.className = `packet ${bgColor}`;
             packet.textContent = text;
             container.appendChild(packet);
             return packet;
        }

        function moveElementTo(el, target) {
            const targetRect = target.getBoundingClientRect();
            const containerRect = el.parentElement.getBoundingClientRect();
            el.style.top = `${targetRect.top - containerRect.top + (target.offsetHeight - el.offsetHeight)/2}px`;
            el.style.left = `${targetRect.left - containerRect.left + (target.offsetWidth - el.offsetWidth)/2}px`;
        }

        function animatePacket(packet, from, to) {
            moveElementTo(packet, from);
            packet.style.opacity = '1';
            setTimeout(() => {
                moveElementTo(packet, to);
            }, 100);
        }

        // Section 1: Architectures
        const archDiagram = document.getElementById('arch-diagram');
        const archBtns = document.querySelectorAll('.arch-btn');
        window.drawArchitecture = function(type) {
            archBtns.forEach(btn => {
                btn.classList.remove('bg-sky-600');
                btn.classList.add('bg-slate-500');
            });
            document.querySelector(`button[onclick="drawArchitecture('${type}')"]`).classList.add('bg-sky-600');
            
            archDiagram.style.opacity = 0;
            setTimeout(() => {
                let html = '';
                if (type === 'bss') {
                    html = `<div class="text-center">
                        <div class="station-icon text-5xl mb-4">ğŸ“¡</div>
                        <p class="font-bold">AP (æ¥å…¥ç‚¹)</p>
                        <div class="flex justify-center space-x-12 mt-8">
                            <div><div class="station-icon">ğŸ’»</div><p class="text-sm">ç«™A</p></div>
                            <div><div class="station-icon">ğŸ“±</div><p class="text-sm">ç«™B</p></div>
                            <div><div class="station-icon">ğŸ’»</div><p class="text-sm">ç«™C</p></div>
                        </div>
                        <p class="mt-6 text-sm text-slate-600">æ‰€æœ‰ç«™ç‚¹éƒ½é€šè¿‡å”¯ä¸€çš„APè¿›è¡Œé€šä¿¡ã€‚</p>
                    </div>`;
                } else if (type === 'ess') {
                    html = `<div class="text-center w-full">
                        <div class="w-full h-1.5 bg-slate-700 my-4 rounded-full"><p class="text-sm font-bold -mt-6 text-slate-700">åˆ†é…ç³»ç»Ÿ (DS)</p></div>
                        <div class="flex justify-around mt-8">
                            <div>
                               <div class="station-icon text-5xl mb-2">ğŸ“¡</div><p class="font-bold">AP 1</p>
                               <div class="flex space-x-4 mt-4"><div><div class="station-icon">ğŸ’»</div></div> <div><div class="station-icon">ğŸ“±</div></div></div>
                            </div>
                            <div>
                               <div class="station-icon text-5xl mb-2">ğŸ“¡</div><p class="font-bold">AP 2</p>
                               <div class="flex space-x-4 mt-4"><div><div class="station-icon">ğŸ’»</div></div> <div><div class="station-icon">ğŸ“±</div></div></div>
                            </div>
                        </div>
                        <p class="mt-6 text-sm text-slate-600">å¤šä¸ªBSSé€šè¿‡ä¸€ä¸ªéª¨å¹²åˆ†é…ç³»ç»Ÿè¿æ¥ï¼Œæ‰©å¤§è¦†ç›–èŒƒå›´ã€‚</p>
                    </div>`;
                } else { // adhoc
                     html = `<div class="text-center">
                        <div class="flex justify-center space-x-12 items-center">
                            <div><div class="station-icon">ğŸ’»</div><p class="text-sm">ç«™A</p></div>
                            <p class="font-bold text-3xl text-slate-400">â†”</p>
                            <div><div class="station-icon">ğŸ“±</div><p class="text-sm">ç«™B</p></div>
                             <p class="font-bold text-3xl text-slate-400">â†”</p>
                            <div><div class="station-icon">ğŸ’»</div><p class="text-sm">ç«™C</p></div>
                        </div>
                        <p class="mt-6 text-sm text-slate-600">ç«™ç‚¹ä¹‹é—´ç›´æ¥é€šä¿¡ï¼Œæ— éœ€APã€‚</p>
                    </div>`;
                }
                archDiagram.innerHTML = html;
                archDiagram.style.opacity = 1;
            }, 300);
        };
        drawArchitecture('bss');

        // CSMA/CA Simulator Section
        const csmacaStartBtn = document.getElementById('csmaca-start-btn');
        const csmacaTimelinesDiv = document.getElementById('csmaca-timelines');
        const csmacaLogDiv = document.getElementById('csmaca-log');
        let simInterval;
        
        const STATIONS_CSMA = ['A', 'B', 'C', 'D'];
        
        function csmacaReset() {
             if (simInterval) clearInterval(simInterval);
             csmacaTimelinesDiv.innerHTML = '';
             csmacaLogDiv.innerHTML = '';
             STATIONS_CSMA.forEach(s => {
                const timelineContainer = document.createElement('div');
                timelineContainer.className = 'flex items-center space-x-2';
                timelineContainer.innerHTML = `<span class="w-10 font-bold text-sm">ç«™ ${s}:</span><div id="timeline-${s}" class="timeline"></div>`;
                csmacaTimelinesDiv.appendChild(timelineContainer);
             });
             csmacaStartBtn.disabled = false;
             csmacaStartBtn.textContent = 'å¯åŠ¨æ¨¡æ‹Ÿ';
        }

        function csmacaStart() {
            csmacaReset();
            csmacaStartBtn.disabled = true;
            csmacaStartBtn.textContent = 'æ¨¡æ‹Ÿä¸­...';

            let time = 0;
            let channelBusyUntil = 0;
            let stationStates = {};
            const DURATION = 100;
            const SLOT_TIME = 1;
            const DIFS = 5 * SLOT_TIME;
            const SIFS = 2 * SLOT_TIME;
            const ACK = 3 * SLOT_TIME;
            const DATA = 20 * SLOT_TIME;

            STATIONS_CSMA.forEach(s => {
                stationStates[s] = { state: 'IDLE', backoff: 0, cw: 8 };
            });

            const log = (msg) => {
                const p = document.createElement('p');
                p.textContent = `[T=${time.toString().padStart(2, '0')}] ${msg}`;
                csmacaLogDiv.prepend(p);
            };

            const addBlock = (s, duration, color) => {
                const timeline = document.getElementById(`timeline-${s}`);
                const block = document.createElement('div');
                block.className = `time-block ${color}`;
                block.style.left = `${time / DURATION * 100}%`;
                block.style.width = '0%';
                timeline.appendChild(block);
                setTimeout(() => {
                    block.style.width = `${duration / DURATION * 100}%`;
                }, 50);
            };

            log('æ¨¡æ‹Ÿå¼€å§‹ï¼Œæ‰€æœ‰ç«™ç‚¹ç©ºé—²ã€‚');
            stationStates['A'].state = 'SENSING';
            stationStates['C'].state = 'SENSING';
            log('ç«™ A å’Œ C æœ‰æ•°æ®è¦å‘é€ï¼Œè¿›å…¥æ„ŸçŸ¥çŠ¶æ€ã€‚');

            simInterval = setInterval(() => {
                if (time >= DURATION) {
                    clearInterval(simInterval);
                    csmacaStartBtn.disabled = false;
                    csmacaStartBtn.textContent = 'å†æ¬¡å¯åŠ¨';
                    return;
                }

                const isChannelBusy = time < channelBusyUntil;

                STATIONS_CSMA.forEach(s => {
                    const state = stationStates[s];
                    switch (state.state) {
                        case 'SENSING':
                            if (!isChannelBusy) {
                                log(`ç«™ ${s} æ„ŸçŸ¥åˆ°ä¿¡é“ç©ºé—²ï¼Œç­‰å¾…DIFSã€‚`);
                                addBlock(s, DIFS, 'bg-blue-500');
                                state.state = 'DIFS';
                                state.waitUntil = time + DIFS;
                            }
                            break;
                        case 'DIFS':
                            if (time >= state.waitUntil) {
                                if (time < channelBusyUntil) {
                                    log(`ç«™ ${s} åœ¨DIFSæœŸé—´å‘ç°ä¿¡é“å˜å¿™ï¼Œè¿”å›æ„ŸçŸ¥ã€‚`);
                                    state.state = 'SENSING';
                                } else {
                                    state.backoff = Math.floor(Math.random() * state.cw);
                                    log(`ç«™ ${s} DIFSç»“æŸï¼Œé€€é¿ ${state.backoff} ä¸ªæ—¶éš™ã€‚`);
                                    state.state = 'BACKOFF';
                                    addBlock(s, state.backoff, 'bg-yellow-400');
                                }
                            }
                            break;
                        case 'BACKOFF':
                            if (!isChannelBusy) {
                                state.backoff--;
                                if (state.backoff <= 0) {
                                    log(`ç«™ ${s} é€€é¿ç»“æŸï¼Œå¼€å§‹å‘é€æ•°æ®ã€‚`);
                                    addBlock(s, DATA, 'bg-green-500');
                                    state.state = 'TX';
                                    channelBusyUntil = time + DATA;
                                }
                            } else {
                                log(`ç«™ ${s} åœ¨é€€é¿ä¸­ï¼Œä¿¡é“å¿™ï¼Œå†»ç»“è®¡æ—¶å™¨ã€‚`);
                            }
                            break;
                        case 'TX':
                            if (time >= channelBusyUntil) {
                                log(`ç«™ ${s} å‘é€å®Œæ¯•ï¼Œç­‰å¾…SIFS+ACKã€‚`);
                                addBlock(s, SIFS, 'bg-indigo-400');
                                addBlock(s, ACK, 'bg-pink-500');
                                state.state = 'WAIT_ACK';
                                channelBusyUntil = time + SIFS + ACK;
                            }
                            break;
                        case 'WAIT_ACK':
                            if (time >= channelBusyUntil) {
                                log(`ç«™ ${s} æ”¶åˆ°ACKï¼ŒæˆåŠŸï¼`);
                                state.state = 'IDLE';
                            }
                            break;
                    }
                });
                time++;
            }, 300);
        }
        csmacaStartBtn.addEventListener('click', csmacaStart);
        csmacaReset();
        
        // RTS/CTS Section
        const rtsCtsDiagram = document.getElementById('rts-cts-diagram');
        const rtsCtsStartBtn = document.getElementById('rts-cts-start-btn');
        const rtsCtsNextBtn = document.getElementById('rts-cts-next-btn');
        const rtsCtsDesc = document.getElementById('rts-cts-desc');
        let rtsCtsStep = 0;
        
        let rtsCtsNodes = {};

        function rtsCtsReset() {
            rtsCtsDiagram.innerHTML = '';
            rtsCtsNodes = {
                a: createStationNode(rtsCtsDiagram, 'æºç«™A', 'ğŸ’»', '50%', '15%'),
                b: createStationNode(rtsCtsDiagram, 'ç›®çš„ç«™B', 'ğŸ’»', '50%', '85%'),
                c: createStationNode(rtsCtsDiagram, 'éšè”½ç«™C', 'ğŸ’»', '15%', '85%'),
            };
            const labelC = rtsCtsNodes.c.querySelector('.station-label');
            labelC.textContent = 'ç«™C (å¬ä¸åˆ°A)';
            labelC.classList.remove('bg-red-500', 'text-white');


            rtsCtsStep = 0;
            rtsCtsDesc.textContent = 'ç‚¹å‡»â€œå¼€å§‹â€æ¼”ç¤ºRTS/CTSæ¡æ‰‹è¿‡ç¨‹ã€‚';
            rtsCtsNextBtn.disabled = true;
            rtsCtsNextBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
            rtsCtsNextBtn.classList.remove('bg-sky-600', 'hover:bg-sky-700');
        }

        const rtsCtsSteps = [
            { desc: 'ç‚¹å‡»â€œå¼€å§‹â€æ¼”ç¤ºRTS/CTSæ¡æ‰‹è¿‡ç¨‹ã€‚' },
            { desc: '1. æºç«™Aå‘ç›®çš„ç«™Bå‘é€RTS (è¯·æ±‚å‘é€) å¸§ã€‚', action: () => {
                const packet = createPacket(rtsCtsDiagram, 'bg-cyan-500', 'RTS');
                animatePacket(packet, rtsCtsNodes.a, rtsCtsNodes.b);
            }},
            { desc: '2. Bæ”¶åˆ°åï¼Œå›å¤CTS (å…è®¸å‘é€) å¸§ã€‚ç«™Cå¬ä¸åˆ°Açš„RTSï¼Œä½†èƒ½å¬åˆ°Bçš„CTSã€‚', action: () => {
                const packet = createPacket(rtsCtsDiagram, 'bg-teal-500', 'CTS');
                animatePacket(packet, rtsCtsNodes.b, rtsCtsNodes.a);
                const packet2 = createPacket(rtsCtsDiagram, 'bg-teal-500', 'CTS');
                animatePacket(packet2, rtsCtsNodes.b, rtsCtsNodes.c);
            }},
            { desc: '3. ç«™Cæ”¶åˆ°CTSåï¼Œå¾—çŸ¥ä¿¡é“å°†è¢«å ç”¨ï¼Œäºæ˜¯è®¾ç½®NAV(ç½‘ç»œåˆ†é…å‘é‡)ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…ä¸å‘é€æ•°æ®ã€‚', action: () => {
                const label = rtsCtsNodes.c.querySelector('.station-label');
                label.textContent = 'ç«™C: NAV Set!';
                label.classList.add('bg-red-500', 'text-white');
            }},
            { desc: '4. ä¿¡é“æ¸…ç©ºï¼Œç«™Aå¯ä»¥å®‰å…¨åœ°å‘é€é•¿æ•°æ®å¸§ç»™Bï¼Œä¸ä¼šä¸Cå‘ç”Ÿç¢°æ’ã€‚', action: () => {
                const packet = createPacket(rtsCtsDiagram, 'bg-green-500', 'DATA');
                packet.style.width = '80px';
                animatePacket(packet, rtsCtsNodes.a, rtsCtsNodes.b);
            }},
            { desc: 'æ¼”ç¤ºç»“æŸã€‚' }
        ];
        
        rtsCtsStartBtn.addEventListener('click', () => {
            rtsCtsReset();
            rtsCtsStep = 1;
            rtsCtsDesc.textContent = rtsCtsSteps[rtsCtsStep].desc;
            rtsCtsNextBtn.disabled = false;
            rtsCtsNextBtn.classList.remove('bg-slate-400', 'cursor-not-allowed');
            rtsCtsNextBtn.classList.add('bg-sky-600', 'hover:bg-sky-700');
        });

        rtsCtsNextBtn.addEventListener('click', () => {
            if (rtsCtsStep > 0 && rtsCtsStep < rtsCtsSteps.length) {
                if(rtsCtsSteps[rtsCtsStep].action) {
                    rtsCtsSteps[rtsCtsStep].action();
                }
                rtsCtsStep++;
                if (rtsCtsStep < rtsCtsSteps.length) {
                    rtsCtsDesc.textContent = rtsCtsSteps[rtsCtsStep].desc;
                }
                if (rtsCtsStep >= rtsCtsSteps.length - 1) {
                    rtsCtsNextBtn.disabled = true;
                    rtsCtsNextBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
                    rtsCtsNextBtn.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                }
            }
        });

        rtsCtsReset();

        // Section 5: MAC Frame
        const scenarioSelect = document.getElementById('scenario-select');
        const frameContainer = document.getElementById('frame-container');
        
        function renderFrame() {
            const scenario = scenarioSelect.value;
            let toDS, fromDS, addr1, addr2, addr3, addr4;
            let addr1Desc, addr2Desc, addr3Desc, addr4Desc;

            if (scenario === 'sta-to-ap') {
                toDS = 1; fromDS = 0;
                addr1 = 'AP_MAC'; addr1Desc = 'æ¥æ”¶æ–¹ (AP)';
                addr2 = 'STA_MAC'; addr2Desc = 'å‘é€æ–¹ (ç§»åŠ¨ç«™)';
                addr3 = 'Final_Dest_MAC'; addr3Desc = 'æœ€ç»ˆç›®çš„';
                addr4 = 'N/A'; addr4Desc = 'ä¸ä½¿ç”¨';
            } else if (scenario === 'ap-to-sta') {
                toDS = 0; fromDS = 1;
                addr1 = 'STA_MAC'; addr1Desc = 'æ¥æ”¶æ–¹ (ç§»åŠ¨ç«™)';
                addr2 = 'AP_MAC'; addr2Desc = 'å‘é€æ–¹ (AP)';
                addr3 = 'Original_Src_MAC'; addr3Desc = 'åŸå§‹æº';
                addr4 = 'N/A'; addr4Desc = 'ä¸ä½¿ç”¨';
            } else { // sta-to-sta
                toDS = 1; fromDS = 1; // This case is more complex, showing a common one
                addr1 = 'AP_MAC'; addr1Desc = 'æ¥æ”¶æ–¹ (AP)';
                addr2 = 'STA_A_MAC'; addr2Desc = 'å‘é€æ–¹ (æºç«™A)';
                addr3 = 'STA_B_MAC'; addr3Desc = 'æœ€ç»ˆç›®çš„ (ç›®çš„ç«™B)';
                addr4 = 'N/A'; addr4Desc = 'ä¸ä½¿ç”¨ (å®é™…WDSä¼šç”¨)';
            }
            
            const frameHTML = `
                <div class="flex flex-nowrap text-center text-xs font-mono border border-gray-300 rounded">
                    <div class="p-2 border-r bg-gray-100 flex-shrink-0">
                        <div class="font-bold">å¸§æ§åˆ¶</div><div>2</div>
                    </div>
                    <div class="p-2 border-r bg-gray-100 flex-shrink-0">
                        <div class="font-bold">æŒç»­æœŸ</div><div>2</div>
                    </div>
                    <div class="p-2 border-r bg-sky-100 flex-shrink-0">
                        <div class="font-bold">åœ°å€1</div><div>${addr1}</div><div class="text-sky-700">${addr1Desc}</div>
                    </div>
                    <div class="p-2 border-r bg-emerald-100 flex-shrink-0">
                        <div class="font-bold">åœ°å€2</div><div>${addr2}</div><div class="text-emerald-700">${addr2Desc}</div>
                    </div>
                    <div class="p-2 border-r bg-amber-100 flex-shrink-0">
                        <div class="font-bold">åœ°å€3</div><div>${addr3}</div><div class="text-amber-700">${addr3Desc}</div>
                    </div>
                    <div class="p-2 border-r bg-gray-100 flex-shrink-0">
                        <div class="font-bold">åºå·</div><div>2</div>
                    </div>
                     <div class="p-2 border-r bg-violet-100 flex-shrink-0">
                        <div class="font-bold">åœ°å€4</div><div>${addr4}</div><div class="text-violet-700">${addr4Desc}</div>
                    </div>
                    <div class="p-2 border-r bg-gray-200 flex-grow min-w-[200px]">
                        <div class="font-bold">å¸§ä¸»ä½“ (æ•°æ®)</div><div>0-2312</div>
                    </div>
                    <div class="p-2 bg-gray-100 flex-shrink-0">
                        <div class="font-bold">FCS</div><div>4</div>
                    </div>
                </div>
                <div class="mt-4 flex space-x-4 text-sm">
                    <div class="p-2 rounded ${toDS ? 'bg-green-200' : 'bg-red-200'}">To DS: ${toDS}</div>
                    <div class="p-2 rounded ${fromDS ? 'bg-green-200' : 'bg-red-200'}">From DS: ${fromDS}</div>
                </div>
            `;
            frameContainer.innerHTML = frameHTML;
        }
        
        scenarioSelect.addEventListener('change', renderFrame);
        renderFrame();

        // Section 6: Standards Chart
        const ctx = document.getElementById('standards-chart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['802.11b', '802.11a/g', '802.11n', '802.11ac', '802.11ad'],
                datasets: [{
                    label: 'æœ€å¤§ç†è®ºé€Ÿç‡ (Mbit/s)',
                    data: [11, 54, 600, 1300, 7000], // Using 1.3 Gbit/s for ac for clarity
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.6)',
                        'rgba(16, 185, 129, 0.6)',
                        'rgba(245, 158, 11, 0.6)',
                        'rgba(239, 68, 68, 0.6)',
                        'rgba(139, 92, 246, 0.6)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(239, 68, 68, 1)',
                        'rgba(139, 92, 246, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        type: 'logarithmic',
                        ticks: {
                            callback: function(value, index, values) {
                                if (value === 10 || value === 100 || value === 1000 || value === 10000) {
                                    return value.toString() + ' Mbit/s';
                                }
                            }
                        }
                    }
                },
                plugins: {
                    title: { display: true, text: '802.11 æ ‡å‡†é€Ÿç‡å¯¹æ¯” (å¯¹æ•°åæ ‡)'},
                    tooltip: {
                         callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' Mbit/s';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

    });
    </script>
</body>
</html>
