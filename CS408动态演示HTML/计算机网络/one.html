<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无线个人区域网(WPAN)交互式指南</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 
        Chosen Palette: Calm Harmony (Slate, Sky, Amber, Emerald)
    -->
    <!-- 
        Application Structure Plan: The application is designed as a tab-based single-page interface. This structure was chosen because the source material naturally categorizes WPAN technologies into distinct standards (Bluetooth, ZigBee, High-Speed). A tabbed layout allows users to focus on one technology at a time for deep learning, while also facilitating easy comparison by switching between tabs. The user journey starts with a high-level overview and a comparative chart, then allows for deep dives into each technology through dedicated sections with text, key specs, and interactive diagrams. This non-linear exploration path is more effective for understanding and comparing complex technical concepts than a linear document.
    -->
    <!-- 
        Visualization & Content Choices: 
        1. Report Info: Comparison of WPAN vs WLAN. Goal: Compare. Viz/Method: Styled HTML table with icons. Justification: Clear, direct comparison of key characteristics. Library: HTML/Tailwind.
        2. Report Info: Key metrics (data rate, range) of different WPAN standards. Goal: Compare. Viz/Method: Bar chart. Justification: Provides an immediate visual summary of performance differences. Interaction: Tooltips on hover for precise data. Library: Chart.js.
        3. Report Info: Bluetooth Piconet/Scatternet structure. Goal: Organize/Relationships. Viz/Method: Interactive diagram using HTML divs and CSS. Justification: Visually demonstrates the master-slave hierarchy and how networks can combine, which is difficult to grasp from text alone. Interaction: Buttons to dynamically add nodes and form a scatternet. Library: Vanilla JS, HTML/Tailwind.
        4. Report Info: ZigBee network topology and node types. Goal: Organize/Relationships. Viz/Method: Interactive diagram similar to Bluetooth's. Justification: Helps users differentiate between Coordinator, Router (FFD), and End Device (RFD) and see how they form different topologies (Star vs. Mesh). Interaction: Buttons to switch between topologies. Library: Vanilla JS, HTML/Tailwind.
    -->
    <!-- 
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 50vh;
        }
        @media (min-width: 768px) {
            .chart-container { height: 450px; }
        }
        .tab-btn {
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .tab-btn.active {
            border-bottom-color: #0ea5e9;
            color: #0284c7;
            font-weight: 600;
        }
        .tab-content {
            transition: opacity 0.5s ease-in-out;
        }
        .tab-content.hidden {
            display: none;
        }
        .diagram-node {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            color: white;
            font-weight: 500;
            position: absolute;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 2px solid rgba(255,255,255,0.5);
            transform: scale(0);
            opacity: 0;
        }
        .diagram-node.visible {
            transform: scale(1);
            opacity: 1;
        }
        .diagram-line {
            position: absolute;
            background-color: #94a3b8;
            height: 2px;
            transform-origin: 0 0;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
            transform: scaleX(0);
        }
        .diagram-line.visible {
            transform: var(--transform-rotate) scaleX(1);
        }
        .content-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -2px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .content-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -4px rgba(0,0,0,0.07);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">无线个人区域网 (WPAN) 交互式指南</h1>
            <p class="mt-2 text-lg text-slate-600">一个用于探索蓝牙、ZigBee及高速WPAN技术的互动平台</p>
        </header>

        <nav class="flex justify-center border-b border-slate-200 mb-8">
            <button data-tab="overview" class="tab-btn active text-lg px-4 py-3 border-b-2 border-transparent">总览与对比</button>
            <button data-tab="bluetooth" class="tab-btn text-lg px-4 py-3 border-b-2 border-transparent">蓝牙 (Bluetooth)</button>
            <button data-tab="zigbee" class="tab-btn text-lg px-4 py-3 border-b-2 border-transparent">ZigBee</button>
            <button data-tab="highspeed" class="tab-btn text-lg px-4 py-3 border-b-2 border-transparent">高速WPAN</button>
        </nav>

        <main>
            <!-- Overview Section -->
            <section id="overview-content" class="tab-content space-y-12">
                <div class="content-card p-6">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">什么是WPAN?</h2>
                    <p class="text-slate-700 leading-relaxed">
                        无线个人区域网 (WPAN) 是一种专注于在个人工作空间（通常为10米半径内）连接个人电子设备的自组网络技术。它的核心目标是替代设备间的短距离电缆，如连接鼠标、键盘、耳机、打印机等，实现便捷的无线化。本节将通过图表和对比，帮助您快速理解WPAN在无线网络世界中的定位。
                    </p>
                </div>
                
                <div class="content-card p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">WPAN vs WLAN: 核心区别</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                            <h4 class="font-bold text-lg mb-2 flex items-center">
                                <span class="text-2xl mr-2">👤</span> 无线个人区域网 (WPAN)
                            </h4>
                            <ul class="list-disc list-inside space-y-2 text-slate-600">
                                <li><strong>核心定位:</strong> 以<span class="font-semibold text-sky-600">个人为中心</span>的电缆替代技术</li>
                                <li><strong>功率:</strong> 低功率</li>
                                <li><strong>范围:</strong> 小范围 (~10米)</li>
                                <li><strong>速率:</strong> 低至中等速率</li>
                                <li><strong>成本:</strong> 低成本</li>
                            </ul>
                        </div>
                        <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                            <h4 class="font-bold text-lg mb-2 flex items-center">
                                <span class="text-2xl mr-2">🏢</span> 无线局域网 (WLAN / Wi-Fi)
                            </h4>
                            <ul class="list-disc list-inside space-y-2 text-slate-600">
                                <li><strong>核心定位:</strong> 同时为<span class="font-semibold text-amber-600">众多用户</span>提供网络接入</li>
                                <li><strong>功率:</strong> 大功率</li>
                                <li><strong>范围:</strong> 中等范围 (~100米)</li>
                                <li><strong>速率:</strong> 高速率</li>
                                <li><strong>成本:</strong> 相对较高</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="content-card p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">主要WPAN技术性能对比</h3>
                     <p class="text-center text-slate-600 mb-6">直观地比较不同WPAN标准在数据速率上的差异。请将鼠标悬停在图表条目上以查看详细信息。</p>
                    <div class="chart-container">
                        <canvas id="wpanComparisonChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Bluetooth Section -->
            <section id="bluetooth-content" class="tab-content hidden space-y-12">
                <div class="content-card p-6">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">蓝牙 (Bluetooth) - IEEE 802.15.1</h2>
                     <p class="text-slate-700 leading-relaxed">
                        蓝牙是最普及的WPAN技术，广泛应用于无线耳机、键盘、智能手表等设备。它工作在2.4GHz的ISM频段，使用跳频扩频(FHSS)技术来抵抗干扰。本节将通过交互式图表演示蓝牙最核心的网络结构：皮可网(Piconet)和扩散网(Scatternet)。
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-6 text-center">
                    <div class="bg-sky-100 p-4 rounded-lg"><div class="font-bold text-sky-800">数据率</div><div class="text-2xl font-bold text-sky-600">~720 kbit/s</div></div>
                    <div class="bg-sky-100 p-4 rounded-lg"><div class="font-bold text-sky-800">范围</div><div class="text-2xl font-bold text-sky-600">~10 米</div></div>
                    <div class="bg-sky-100 p-4 rounded-lg"><div class="font-bold text-sky-800">核心技术</div><div class="text-2xl font-bold text-sky-600">FHSS</div></div>
                </div>
                <div class="content-card p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">交互式网络结构演示</h3>
                    <p class="text-center text-slate-600 mb-6">点击按钮，观察蓝牙网络如何从一个主设备和几个从设备组成的“皮可网”，扩展为由多个皮可网互联构成的“扩散网”。</p>
                    <div class="flex justify-center space-x-4 mb-6">
                        <button id="addSlaveBtn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">添加从设备 (Slave)</button>
                        <button id="formScatternetBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">形成扩散网 (Scatternet)</button>
                        <button id="resetBluetoothBtn" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">重置</button>
                    </div>
                    <div id="bluetoothDiagram" class="relative w-full h-96 bg-slate-100 rounded-lg overflow-hidden border border-slate-200">
                    </div>
                </div>
            </section>

            <!-- ZigBee Section -->
            <section id="zigbee-content" class="tab-content hidden space-y-12">
                 <div class="content-card p-6">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">ZigBee - IEEE 802.15.4</h2>
                    <p class="text-slate-700 leading-relaxed">
                        ZigBee专为低速率、低功耗、低成本的无线通信而设计，是物联网（IoT）领域的关键技术，广泛应用于智能家居、工业自动化和环境监测。其最大的特点是极低的功耗和强大的组网能力。本节将展示ZigBee网络中的不同设备角色及其组成的典型拓扑结构。
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-6 text-center">
                    <div class="bg-emerald-100 p-4 rounded-lg"><div class="font-bold text-emerald-800">数据率</div><div class="text-2xl font-bold text-emerald-600">20-250 kbit/s</div></div>
                    <div class="bg-emerald-100 p-4 rounded-lg"><div class="font-bold text-emerald-800">核心优势</div><div class="text-2xl font-bold text-emerald-600">极低功耗</div></div>
                    <div class="bg-emerald-100 p-4 rounded-lg"><div class="font-bold text-emerald-800">网络容量</div><div class="text-2xl font-bold text-emerald-600">>64000 节点</div></div>
                </div>
                 <div class="content-card p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">交互式拓扑结构演示</h3>
                    <p class="text-center text-slate-600 mb-6">切换不同拓扑，观察协调器、路由器和终端设备在ZigBee网络中的不同角色和连接方式。</p>
                    <div class="flex justify-center space-x-4 mb-6">
                        <button id="starTopoBtn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">星形拓扑 (Star)</button>
                        <button id="meshTopoBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm transition-transform hover:scale-105">网状拓扑 (Mesh)</button>
                    </div>
                    <div id="zigbeeDiagram" class="relative w-full h-96 bg-slate-100 rounded-lg overflow-hidden border border-slate-200">
                        <div class="absolute top-4 left-4 flex flex-col space-y-2 text-xs bg-white/70 p-2 rounded-md shadow-sm backdrop-blur-sm z-10">
                           <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-red-500 mr-2 border border-white"></span><span class="font-semibold">协调器:</span> 网络的创建者和管理者。</div>
                           <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-amber-500 mr-2 border border-white"></span><span class="font-semibold">路由器(FFD):</span> 扩展网络范围，转发数据。</div>
                           <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-slate-500 mr-2 border border-white"></span><span class="font-semibold">终端(RFD):</span> 低功耗设备，仅与父节点通信。</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- High-Speed Section -->
            <section id="highspeed-content" class="tab-content hidden space-y-12">
                 <div class="content-card p-6">
                    <h2 class="text-2xl font-bold mb-4 text-slate-800">高速WPAN - IEEE 802.15.3</h2>
                     <p class="text-slate-700 leading-relaxed">
                        为了满足便携式多媒体设备之间高速数据传输的需求（如无线传输高清视频），IEEE制定了高速WPAN标准。其演进版本更是引入了超宽带（UWB）技术，将速率提升至数百兆比特每秒，但传输距离非常有限，通常局限于单个房间内。
                    </p>
                </div>
                 <div class="grid md:grid-cols-2 gap-6 text-center">
                    <div class="bg-amber-100 p-4 rounded-lg">
                        <div class="font-bold text-amber-800">IEEE 802.15.3</div>
                        <div class="text-2xl font-bold text-amber-600">11-55 Mbit/s</div>
                        <p class="text-sm text-amber-700 mt-1">用于多媒体设备连接</p>
                    </div>
                    <div class="bg-amber-100 p-4 rounded-lg">
                        <div class="font-bold text-amber-800">UWB (超宽带)</div>
                        <div class="text-2xl font-bold text-amber-600">100-400 Mbit/s</div>
                        <p class="text-sm text-amber-700 mt-1">用于小范围高清视频传输</p>
                    </div>
                </div>
                 <div class="content-card p-6">
                    <h3 class="text-xl font-bold mb-2">核心原理：香农公式的应用</h3>
                    <p class="text-slate-700 leading-relaxed">
                        高速WPAN，特别是UWB技术，是香农公式 <code class="bg-slate-200 text-sm p-1 rounded-md">C = B × log₂(1 + S/N)</code> 的一个典型应用。公式表明，信道容量（C，即最大传输速率）与信道带宽（B）成正比。UWB技术正是通过使用3.1-10.6 GHz的**巨大带宽**，来换取极高的数据传输速率，即便其信号功率（S/N）可能不高。
                    </p>
                    <div class="mt-4 bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-bold">典型应用场景:</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-600">
                            <li>将数码摄像机拍摄的4K视频无线传输到电视上播放。</li>
                            <li>在没有连接线的情况下，快速将大量照片从相机复制到电脑。</li>
                            <li>会议室中，将笔记本电脑的屏幕内容无线投影到大屏幕。</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab navigation logic
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const target = tab.getAttribute('data-tab');
                    contents.forEach(content => {
                        content.style.opacity = '0';
                        if (content.id === `${target}-content`) {
                            content.classList.remove('hidden');
                            setTimeout(() => content.style.opacity = '1', 50);
                        } else {
                           setTimeout(() => content.classList.add('hidden'), 300);
                        }
                    });
                });
            });

            // Chart.js data and configuration
            const wpanData = {
                labels: ['蓝牙 (Bluetooth)', 'ZigBee', '高速WPAN (802.15.3)', '超宽带 (UWB)'],
                datasets: [{
                    label: '最高数据速率 (Mbit/s)',
                    data: [0.72, 0.25, 55, 400],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.6)',
                        'rgba(16, 185, 129, 0.6)',
                        'rgba(245, 158, 11, 0.6)',
                        'rgba(217, 70, 239, 0.6)',
                    ],
                    borderColor: [
                        'rgba(37, 99, 235, 1)',
                        'rgba(5, 150, 105, 1)',
                        'rgba(217, 119, 6, 1)',
                        'rgba(192, 38, 211, 1)',
                    ],
                    borderWidth: 2
                }]
            };

            const chartCtx = document.getElementById('wpanComparisonChart').getContext('2d');
            new Chart(chartCtx, {
                type: 'bar',
                data: wpanData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: '数据速率 (Mbit/s, 对数坐标)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += context.parsed.x + ' Mbit/s';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Reusable Diagram Logic
            function createDiagramNode(container, id, text, cssClass, top, left, size = 'w-16 h-16') {
                const node = document.createElement('div');
                node.id = id;
                node.textContent = text;
                node.className = `diagram-node ${cssClass} ${size}`;
                node.style.top = `calc(${top} - ${parseInt(size.split(' ')[1].substring(2))/2}rem)`;
                node.style.left = `calc(${left} - ${parseInt(size.split(' ')[0].substring(2))/2}rem)`;
                container.appendChild(node);
                setTimeout(() => node.classList.add('visible'), 50);
                return node;
            }

            function createDiagramLine(container, fromNode, toNode) {
                const containerRect = container.getBoundingClientRect();
                if (!containerRect.width) return;
                
                const fromRect = fromNode.getBoundingClientRect();
                const toRect = toNode.getBoundingClientRect();

                const fromX = fromRect.left + fromRect.width / 2 - containerRect.left;
                const fromY = fromRect.top + fromRect.height / 2 - containerRect.top;
                const toX = toRect.left + toRect.width / 2 - containerRect.left;
                const toY = toRect.top + toRect.height / 2 - containerRect.top;

                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                const length = Math.hypot(toX - fromX, toY - fromY);

                const line = document.createElement('div');
                line.className = 'diagram-line';
                line.style.width = `${length}px`;
                line.style.top = `${fromY}px`;
                line.style.left = `${fromX}px`;
                line.style.setProperty('--transform-rotate', `rotate(${angle}deg)`);
                container.appendChild(line);
                setTimeout(() => line.classList.add('visible'), 100);
            }

            // Bluetooth Diagram Logic
            const bluetoothDiagram = document.getElementById('bluetoothDiagram');
            let bluetoothNodes = {};

            function initBluetooth() {
                bluetoothDiagram.innerHTML = '';
                bluetoothNodes = {};
                bluetoothNodes.master1 = createDiagramNode(bluetoothDiagram, 'master1', '主', 'bg-sky-600', '50%', '50%', 'w-20 h-20');
                bluetoothNodes.slaves = [];
                bluetoothNodes.scatternet = null;
            }

            document.getElementById('addSlaveBtn').addEventListener('click', () => {
                if (bluetoothNodes.slaves.length < 7) {
                    const i = bluetoothNodes.slaves.length;
                    const angle = (i * 360 / 7) * Math.PI / 180;
                    const x = 50 + 38 * Math.cos(angle);
                    const y = 50 + 38 * Math.sin(angle);
                    const slaveNode = createDiagramNode(bluetoothDiagram, `slave${i}`, '从', 'bg-slate-500', `${y}%`, `${x}%`);
                    bluetoothNodes.slaves.push(slaveNode);
                    setTimeout(() => createDiagramLine(bluetoothDiagram, bluetoothNodes.master1, slaveNode), 10);
                }
            });

            document.getElementById('formScatternetBtn').addEventListener('click', () => {
                if (bluetoothNodes.slaves.length > 0 && !bluetoothNodes.scatternet) {
                    const bridgeNode = bluetoothNodes.slaves[0];
                    bridgeNode.textContent = '主/从';
                    bridgeNode.classList.remove('bg-slate-500');
                    bridgeNode.classList.add('bg-purple-600');

                    const master2 = createDiagramNode(bluetoothDiagram, 'master2', '主', 'bg-sky-600', '20%', '85%', 'w-20 h-20');
                    const slave2a = createDiagramNode(bluetoothDiagram, 'slave2a', '从', 'bg-slate-500', '40%', '90%');
                    
                    bluetoothNodes.scatternet = { master: master2, slaves: [slave2a] };
                    setTimeout(() => {
                        createDiagramLine(bluetoothDiagram, bridgeNode, master2);
                        createDiagramLine(bluetoothDiagram, master2, slave2a);
                    }, 10);
                }
            });

            document.getElementById('resetBluetoothBtn').addEventListener('click', initBluetooth);
            
            // ZigBee Diagram Logic
            const zigbeeDiagram = document.getElementById('zigbeeDiagram');
            
            function drawZigbee(topology) {
                zigbeeDiagram.innerHTML = '';
                
                const positions = {
                    coord: { top: '50%', left: '50%' },
                    r1: { top: '20%', left: '25%' },
                    r2: { top: '30%', left: '75%' },
                    r3: { top: '75%', left: '80%' },
                    r4: { top: '80%', left: '30%' },
                    d1: { top: '5%', left: '10%' },
                    d2: { top: '5%', left: '45%' },
                    d3: { top: '50%', left: '95%' },
                    d4: { top: '95%', left: '15%' },
                    d5: { top: '95%', left: '60%' },
                };

                const coordinator = createDiagramNode(zigbeeDiagram, 'coord', '协调器', 'bg-red-500', positions.coord.top, positions.coord.left, 'w-20 h-20');
                const routers = [
                    createDiagramNode(zigbeeDiagram, 'r1', '路由', 'bg-amber-500', positions.r1.top, positions.r1.left, 'w-16 h-16'),
                    createDiagramNode(zigbeeDiagram, 'r2', '路由', 'bg-amber-500', positions.r2.top, positions.r2.left, 'w-16 h-16'),
                    createDiagramNode(zigbeeDiagram, 'r3', '路由', 'bg-amber-500', positions.r3.top, positions.r3.left, 'w-16 h-16'),
                    createDiagramNode(zigbeeDiagram, 'r4', '路由', 'bg-amber-500', positions.r4.top, positions.r4.left, 'w-16 h-16'),
                ];
                const devices = [
                    createDiagramNode(zigbeeDiagram, 'd1', '终端', 'bg-slate-500', positions.d1.top, positions.d1.left, 'w-12 h-12'),
                    createDiagramNode(zigbeeDiagram, 'd2', '终端', 'bg-slate-500', positions.d2.top, positions.d2.left, 'w-12 h-12'),
                    createDiagramNode(zigbeeDiagram, 'd3', '终端', 'bg-slate-500', positions.d3.top, positions.d3.left, 'w-12 h-12'),
                    createDiagramNode(zigbeeDiagram, 'd4', '终端', 'bg-slate-500', positions.d4.top, positions.d4.left, 'w-12 h-12'),
                    createDiagramNode(zigbeeDiagram, 'd5', '终端', 'bg-slate-500', positions.d5.top, positions.d5.left, 'w-12 h-12'),
                ];

                const ffdNodes = [coordinator, ...routers];
                
                requestAnimationFrame(() => {
                    if (topology === 'star') {
                        ffdNodes.slice(1).forEach(r => createDiagramLine(zigbeeDiagram, coordinator, r));
                    } else { // mesh
                         for(let i=0; i<ffdNodes.length; i++) {
                             for (let j=i+1; j<ffdNodes.length; j++) {
                                 const rect1 = ffdNodes[i].getBoundingClientRect();
                                 const rect2 = ffdNodes[j].getBoundingClientRect();
                                 const cx1 = rect1.left + rect1.width / 2;
                                 const cy1 = rect1.top + rect1.height / 2;
                                 const cx2 = rect2.left + rect2.width / 2;
                                 const cy2 = rect2.top + rect2.height / 2;
                                 const dist = Math.hypot(cx1 - cx2, cy1 - cy2);
                                 
                                 if (dist < 250) { 
                                    createDiagramLine(zigbeeDiagram, ffdNodes[i], ffdNodes[j]);
                                 }
                             }
                         }
                    }
                    devices.forEach(d => {
                        const dRect = d.getBoundingClientRect();
                        const dcx = dRect.left + dRect.width / 2;
                        const dcy = dRect.top + dRect.height / 2;

                        let closestNode = null;
                        let minDistance = Infinity;

                        ffdNodes.forEach(ffd => {
                            const ffdRect = ffd.getBoundingClientRect();
                            const ffdcx = ffdRect.left + ffdRect.width / 2;
                            const ffdcy = ffdRect.top + ffdRect.height / 2;
                            const distance = Math.hypot(dcx - ffdcx, dcy - ffdcy);
                            if (distance < minDistance) {
                                minDistance = distance;
                                closestNode = ffd;
                            }
                        });
                        
                        if (closestNode) {
                            createDiagramLine(zigbeeDiagram, closestNode, d);
                        }
                    });
                });
            }
            
            document.getElementById('starTopoBtn').addEventListener('click', () => drawZigbee('star'));
            document.getElementById('meshTopoBtn').addEventListener('click', () => drawZigbee('mesh'));

            // Initialize first view
            initBluetooth();
            drawZigbee('star');
        });
    </script>
</body>
</html>
