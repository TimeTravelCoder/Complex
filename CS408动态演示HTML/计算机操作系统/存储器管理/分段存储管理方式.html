<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼å­¦ä¹ ç¬”è®°ï¼šåˆ†æ®µå­˜å‚¨ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Academic Slate (Background: slate-50, Text: slate-800, Primary: slate-700, Highlight: amber-400, Accent: sky-500) -->
    <!-- Application Structure Plan: The application is designed as a focused learning module on segmentation. It begins by explaining the "why" (motivations), then dives into the core interactive element: a detailed address translation simulator that explains the "how". Following this, it provides a direct visual comparison to paging to solidify understanding, and concludes with advanced concepts like sharing and segmented paging. This structure (Why -> How -> Compare -> Extend) is a proven pedagogical pattern for building robust mental models. -->
    <!-- Visualization & Content Choices:
        - Motivations Section: Goal: Inform. Method: A set of five distinct info cards (HTML/CSS). Interaction: None. Justification: Quickly presents the core reasons for segmentation's existence as a foundation.
        - Address Translation Simulator: Goal: Inform/Organize/Interact. Method: A multi-component diagram (CPU, STR, Segment Table, Memory) built with HTML/CSS. Interaction: User inputs segment number and offset, then clicks a button to trigger a step-by-step JS animation of the entire two-check translation process. Justification: This is the application's centerpiece. It makes the abstract, multi-step translation process tangible and easy to follow. It also visually demonstrates boundary checks, a key concept.
        - Paging vs. Segmentation: Goal: Compare. Method: A side-by-side comparison using styled cards instead of a plain table. Interaction: None. Justification: Provides a high-contrast, easily digestible summary of the key differences discussed in the source document.
        - Information Sharing Diagram: Goal: Inform/Organize. Method: An HTML/CSS diagram showing two processes' segment tables pointing to the same physical memory location. Interaction: None necessary, the visual itself is the explanation. Justification: Clearly illustrates the mechanism for sharing code segments.
        - Segmented Paging Diagram: Goal: Inform/Organize. Method: A simplified flow diagram using styled divs. Interaction: None. Justification: Introduces the hybrid concept by showing the three-part address structure and the two-level table lookup (segment table -> page table).
        - Library/Method: Vanilla JS for all simulation logic and animation. No external charting libraries needed. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; /* slate-50 */ }
        .section-card { background-color: white; border-radius: 0.75rem; padding: 1.5rem 2rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-bottom: 2rem; }
        .sim-component { border: 2px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; background-color: #f8fafc; }
        .address-part { padding: 0.5rem; border-radius: 0.25rem; font-family: monospace; text-align: center; }
        .segment-num { background-color: #f0f9ff; /* sky-50 */ color: #0369a1; /* sky-800 */ }
        .offset-num { background-color: #fefce8; /* yellow-50 */ color: #a16207; /* yellow-800 */ }
        .highlight-process { transition: all 0.3s; box-shadow: 0 0 0 4px #fbbf24; /* amber-400 */ }
        .highlight-success { box-shadow: 0 0 0 4px #22c55e; /* green-500 */ }
        .highlight-error { box-shadow: 0 0 0 4px #ef4444; /* red-500 */ }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">åˆ†æ®µå­˜å‚¨ç®¡ç†æ–¹å¼</h1>
            <p class="mt-4 text-lg text-slate-600">ä¸€ç§æ›´ç¬¦åˆç¨‹åºé€»è¾‘ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚</p>
        </header>

        <!-- Section 1: Motivations -->
        <section class="section-card">
            <h2 class="text-2xl font-bold mb-4">ä¸ºä½•å¼•å…¥åˆ†æ®µï¼Ÿ</h2>
            <p class="mb-6 text-slate-600">åˆ†æ®µç®¡ç†çš„å‡ºç°å¹¶éä¸»è¦ä¸ºäº†è§£å†³ç¢ç‰‡é—®é¢˜ï¼Œè€Œæ˜¯ä¸ºäº†æ›´å¥½åœ°æ»¡è¶³ç¨‹åºå‘˜å’Œåº”ç”¨ç¨‹åºåœ¨é€»è¾‘å±‚é¢çš„éœ€æ±‚ã€‚</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 text-center">
                <div class="p-4 bg-slate-100 rounded-lg">
                    <div class="text-3xl">ğŸ’»</div><h3 class="font-bold mt-2">æ–¹ä¾¿ç¼–ç¨‹</h3><p class="text-xs mt-1">æŒ‰é€»è¾‘åŠŸèƒ½ï¼ˆä¸»ç¨‹åºã€å‡½æ•°ï¼‰åˆ’åˆ†ä»£ç ã€‚</p>
                </div>
                <div class="p-4 bg-slate-100 rounded-lg">
                    <div class="text-3xl">ğŸ¤</div><h3 class="font-bold mt-2">ä¿¡æ¯å…±äº«</h3><p class="text-xs mt-1">ä»¥æ®µä¸ºå•ä½è½»æ¾å…±äº«å‡½æ•°åº“æˆ–æ•°æ®ã€‚</p>
                </div>
                <div class="p-4 bg-slate-100 rounded-lg">
                    <div class="text-3xl">ğŸ›¡ï¸</div><h3 class="font-bold mt-2">ä¿¡æ¯ä¿æŠ¤</h3><p class="text-xs mt-1">ä¸ºä¸åŒæ®µï¼ˆä»£ç ã€æ•°æ®ï¼‰è®¾ç½®ä¸åŒæƒé™ã€‚</p>
                </div>
                <div class="p-4 bg-slate-100 rounded-lg">
                    <div class="text-3xl">ğŸ“ˆ</div><h3 class="font-bold mt-2">åŠ¨æ€å¢é•¿</h3><p class="text-xs mt-1">æ–¹ä¾¿æ•°æ®æ®µï¼ˆå¦‚æ ˆï¼‰åœ¨è¿è¡Œæ—¶æ‰©å±•ã€‚</p>
                </div>
                <div class="p-4 bg-slate-100 rounded-lg">
                    <div class="text-3xl">ğŸ”—</div><h3 class="font-bold mt-2">åŠ¨æ€é“¾æ¥</h3><p class="text-xs mt-1">åœ¨éœ€è¦æ—¶æ‰é“¾æ¥å’ŒåŠ è½½ç¨‹åºæ®µã€‚</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Address Translation Simulator -->
        <section id="simulator" class="section-card">
            <h2 class="text-3xl font-bold mb-2">åœ°å€å˜æ¢è¿‡ç¨‹æ¨¡æ‹Ÿå™¨</h2>
            <p class="text-slate-600 mb-6">åˆ†æ®µç®¡ç†çš„æ ¸å¿ƒåœ¨äºå…¶äºŒç»´åœ°å€çš„å˜æ¢è¿‡ç¨‹ã€‚è¯·è¾“å…¥æ®µå·å’Œæ®µå†…åœ°å€ï¼Œè§‚å¯Ÿç¡¬ä»¶å¦‚ä½•é€šè¿‡æ®µè¡¨å°†å…¶ç¿»è¯‘ä¸ºç‰©ç†åœ°å€ï¼Œå¹¶æ³¨æ„ä¸¤æ¬¡å…³é”®çš„è¶Šç•Œæ£€æŸ¥ã€‚</p>
            
            <div class="bg-slate-100 p-4 rounded-lg mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <label class="font-bold">è¾“å…¥é€»è¾‘åœ°å€:</label>
                    <div>
                        <label for="seg-num" class="text-sm font-medium">æ®µå· (S)</label>
                        <input type="number" id="seg-num" value="2" class="w-24 p-2 border border-slate-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label for="seg-offset" class="text-sm font-medium">æ®µå†…åœ°å€ (W)</label>
                        <input type="number" id="seg-offset" value="100" class="w-24 p-2 border border-slate-300 rounded-md shadow-sm">
                    </div>
                    <button id="translate-btn" class="bg-slate-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700 transition">â–¶ï¸ å¼€å§‹å˜æ¢</button>
                </div>
                 <div id="physical-address-result" class="mt-4 font-mono hidden"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 relative">
                 <!-- CPU and STR -->
                <div class="sim-component">
                    <h3 class="font-bold text-center">CPU & æ®µè¡¨å¯„å­˜å™¨ (STR)</h3>
                    <div id="cpu-output" class="mt-4 p-4 bg-white rounded text-center font-mono">ç­‰å¾…æŒ‡ä»¤...</div>
                    <div id="str-info" class="mt-4 text-sm font-mono p-2 bg-slate-200 rounded">
                        <p>æ®µè¡¨å§‹å€: <span class="font-bold">14000</span></p>
                        <p>æ®µè¡¨é•¿åº¦ (TL): <span class="font-bold">4</span></p>
                     </div>
                </div>

                <!-- Segment Table -->
                 <div class="sim-component">
                    <h3 class="font-bold text-center mb-2">æ®µè¡¨ (åœ¨å†…å­˜ä¸­)</h3>
                     <table id="seg-table" class="w-full text-sm font-mono text-center">
                        <thead class="border-b"><tr class="text-slate-500"><th class="py-1">æ®µå·</th><th class="py-1">æ®µé•¿ (SL)</th><th class="py-1">åŸºå€ (Base)</th></tr></thead>
                        <tbody>
                            <tr data-seg="0"><td>0</td><td>1024</td><td>6300</td></tr>
                            <tr data-seg="1"><td>1</td><td>4200</td><td>2400</td></tr>
                            <tr data-seg="2"><td>2</td><td>500</td><td>8192</td></tr>
                            <tr data-seg="3"><td>3</td><td>800</td><td>9800</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
             <div class="mt-6">
                <h3 class="font-bold text-lg mb-2">æ“ä½œæ—¥å¿—</h3>
                <div id="log-area" class="h-48 bg-slate-800 text-white font-mono text-sm p-4 rounded-lg overflow-y-auto"></div>
            </div>
        </section>

        <!-- Section 3: Paging vs Segmentation -->
        <section class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-center">åˆ†é¡µ vs. åˆ†æ®µï¼šæ ¸å¿ƒåŒºåˆ«</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-4 mt-6">
                <div class="p-4 rounded-lg bg-slate-50">
                    <h3 class="font-bold text-center">å•ä½æ€§è´¨</h3>
                    <p class="text-xs mt-2"><b class="text-sky-600">åˆ†é¡µ:</b> ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œå¤§å°å›ºå®šã€‚</p>
                    <p class="text-xs mt-1"><b class="text-amber-600">åˆ†æ®µ:</b> ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå¤§å°å¯å˜ã€‚</p>
                </div>
                <div class="p-4 rounded-lg bg-slate-50">
                    <h3 class="font-bold text-center">ç›®çš„</h3>
                    <p class="text-xs mt-2"><b class="text-sky-600">åˆ†é¡µ:</b> æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œæ˜¯ç³»ç»Ÿè¡Œä¸ºã€‚</p>
                    <p class="text-xs mt-1"><b class="text-amber-600">åˆ†æ®µ:</b> æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œæ˜¯ç”¨æˆ·è¡Œä¸ºã€‚</p>
                </div>
                <div class="p-4 rounded-lg bg-slate-50">
                    <h3 class="font-bold text-center">åœ°å€ç©ºé—´</h3>
                    <p class="text-xs mt-2"><b class="text-sky-600">åˆ†é¡µ:</b> ä¸€ç»´çš„çº¿æ€§åœ°å€ã€‚</p>
                    <p class="text-xs mt-1"><b class="text-amber-600">åˆ†æ®µ:</b> äºŒç»´çš„ï¼ˆæ®µå·, æ®µå†…åœ°å€ï¼‰ã€‚</p>
                </div>
                <div class="p-4 rounded-lg bg-slate-50">
                    <h3 class="font-bold text-center">å¯è§æ€§</h3>
                    <p class="text-xs mt-2"><b class="text-sky-600">åˆ†é¡µ:</b> å¯¹ç”¨æˆ·é€æ˜ã€‚</p>
                    <p class="text-xs mt-1"><b class="text-amber-600">åˆ†æ®µ:</b> å¯¹ç”¨æˆ·å¯è§ã€‚</p>
                </div>
                 <div class="p-4 rounded-lg bg-slate-50">
                    <h3 class="font-bold text-center">ç¢ç‰‡</h3>
                    <p class="text-xs mt-2"><b class="text-sky-600">åˆ†é¡µ:</b> æœ‰å†…éƒ¨ç¢ç‰‡ï¼Œæ— å¤–éƒ¨ç¢ç‰‡ã€‚</p>
                    <p class="text-xs mt-1"><b class="text-amber-600">åˆ†æ®µ:</b> æœ‰å¤–éƒ¨ç¢ç‰‡ï¼Œæ— å†…éƒ¨ç¢ç‰‡ã€‚</p>
                </div>
            </div>
        </section>
        
        <!-- Section 4: Advanced Concepts -->
        <section class="section-card">
            <h2 class="text-2xl font-bold mb-4">é«˜çº§æ¦‚å¿µå›¾è§£</h2>
             <div class="grid md:grid-cols-2 gap-8">
                <div class="p-4 bg-slate-50 rounded-lg">
                    <h3 class="font-bold text-lg">â„¹ï¸ ä¿¡æ¯å…±äº«</h3>
                    <p class="text-sm mt-2">å¤šä¸ªè¿›ç¨‹çš„æ®µè¡¨å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†å†…å­˜æ®µã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½å…±äº«ä¸€ä¸ªä»£ç æ®µï¼ˆæ®µ2ï¼‰ã€‚</p>
                    <div class="mt-4 flex justify-around items-start text-xs font-mono">
                        <div>
                            <b>è¿›ç¨‹Aæ®µè¡¨</b>
                            <table class="w-full mt-1 bg-white">
                                <tr><td class="border p-1">1: (.. , 1000)</td></tr>
                                <tr><td class="border p-1 bg-sky-200">2: (.. , 5000)</td></tr>
                            </table>
                        </div>
                        <div class="pt-12 text-2xl text-slate-400">â†˜<br>â†™</div>
                        <div>
                            <b>è¿›ç¨‹Bæ®µè¡¨</b>
                             <table class="w-full mt-1 bg-white">
                                <tr><td class="border p-1">3: (.. , 8000)</td></tr>
                                <tr><td class="border p-1 bg-sky-200">2: (.. , 5000)</td></tr>
                            </table>
                        </div>
                    </div>
                    <div class="mt-2 text-center text-sm font-mono p-2 bg-sky-100 rounded">å†…å­˜åœ°å€ 5000: [å…±äº«ä»£ç ...]</div>
                </div>
                <div class="p-4 bg-slate-50 rounded-lg">
                    <h3 class="font-bold text-lg">ğŸ§¬ æ®µé¡µå¼ç®¡ç†</h3>
                    <p class="text-sm mt-2">ç»“åˆäºŒè€…ä¼˜ç‚¹ï¼šå…ˆåˆ†æ®µï¼Œå†å¯¹æ¯æ®µåˆ†é¡µã€‚åœ°å€å˜æ¢éœ€è¦ä¸¤æ¬¡æŸ¥è¡¨ã€‚</p>
                    <div class="font-mono text-xs mt-4 p-2 bg-white rounded space-y-1">
                        <p class="text-center">é€»è¾‘åœ°å€: [æ®µå· S][é¡µå· P][åœ°å€ W]</p>
                        <p>1. S â†’ æŸ¥ <b class="text-amber-600">æ®µè¡¨</b> â†’ æ‰¾åˆ°é¡µè¡¨åŸºå€</p>
                        <p class="pl-4">â†³ (è®¿é—®å†…å­˜ #1)</p>
                        <p>2. P â†’ æŸ¥ <b class="text-sky-600">é¡µè¡¨</b> â†’ æ‰¾åˆ°ç‰©ç†å—å·</p>
                        <p class="pl-4">â†³ (è®¿é—®å†…å­˜ #2)</p>
                        <p>3. å—å·+W â†’ ç‰©ç†åœ°å€ â†’ è®¿é—®æ•°æ®</p>
                         <p class="pl-4">â†³ (è®¿é—®å†…å­˜ #3)</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

<script>
class SegmentationSimulator {
    constructor() {
        this.logArea = document.getElementById('log-area');
        this.cpuOutput = document.getElementById('cpu-output');
        this.strInfo = document.getElementById('str-info');
        this.segTable = document.getElementById('seg-table');
        this.resultDiv = document.getElementById('physical-address-result');
        this.translateBtn = document.getElementById('translate-btn');
        
        this.segmentTableData = {
            0: { length: 1024, base: 6300 },
            1: { length: 4200, base: 2400 },
            2: { length: 500, base: 8192 },
            3: { length: 800, base: 9800 }
        };
        this.segmentTableLength = 4;
        
        this.translateBtn.addEventListener('click', () => this.translate());
        this.log('æ¨¡æ‹Ÿå™¨å·²å°±ç»ªã€‚');
    }

    log(message, step) {
        const stepPrefix = step ? `<span class="text-amber-300">${step}.</span> ` : '';
        this.logArea.innerHTML += `<p class="fade-in">> ${stepPrefix}${message}</p>`;
        this.logArea.scrollTop = this.logArea.scrollHeight;
    }

    reset() {
        this.translateBtn.disabled = false;
        this.logArea.innerHTML = '';
        this.resultDiv.classList.add('hidden');
        document.querySelectorAll('.highlight-process, .highlight-success, .highlight-error').forEach(el => {
            el.classList.remove('highlight-process', 'highlight-success', 'highlight-error');
        });
        this.log('æ¨¡æ‹Ÿå™¨å·²é‡ç½®ã€‚');
    }

    async highlight(element, className, duration = 1000) {
        if (!element) return;
        element.classList.add(className);
        await this.sleep(duration);
        element.classList.remove(className);
    }
    
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async translate() {
        this.reset();
        this.translateBtn.disabled = true;
        let step = 1;

        const segNum = parseInt(document.getElementById('seg-num').value);
        const offset = parseInt(document.getElementById('seg-offset').value);

        if (isNaN(segNum) || isNaN(offset)) {
            this.log('<span class="text-red-400">é”™è¯¯: è¯·è¾“å…¥æœ‰æ•ˆçš„æ®µå·å’Œæ®µå†…åœ°å€ã€‚</span>');
            this.translateBtn.disabled = false;
            return;
        }

        // Step 1: CPU
        this.log(`CPU å‘å‡ºé€»è¾‘åœ°å€ (S=${segNum}, W=${offset})`, step++);
        this.cpuOutput.textContent = `(S = ${segNum}, W = ${offset})`;
        await this.highlight(this.cpuOutput, 'highlight-process');

        // Step 2: Check segment number
        this.log(`å°†æ®µå· S (${segNum}) ä¸æ®µè¡¨é•¿åº¦ TL (${this.segmentTableLength}) æ¯”è¾ƒ`, step++);
        await this.highlight(this.strInfo, 'highlight-process');
        if (segNum >= this.segmentTableLength) {
            this.log(`<span class="text-red-400">é”™è¯¯: æ®µå·è¶Šç•Œ (S >= TL)ã€‚äº§ç”Ÿè¶Šç•Œä¸­æ–­ã€‚</span>`);
            await this.highlight(this.strInfo, 'highlight-error');
            this.translateBtn.disabled = false;
            return;
        }
        this.log(`æ£€æŸ¥é€šè¿‡ (S < TL)ã€‚`);
        await this.sleep(500);

        // Step 3: Find segment table entry
        this.log(`æŸ¥æ‰¾æ®µè¡¨é¡¹ã€‚åœ°å€ = STR.Base + S * entry_sizeã€‚å®šä½åˆ°æ®µ ${segNum}ã€‚`, step++);
        const segRow = document.querySelector(`#seg-table tr[data-seg="${segNum}"]`);
        await this.highlight(segRow, 'highlight-process');
        
        const { length: segLength, base: segBase } = this.segmentTableData[segNum];
        this.log(`ä»æ®µè¡¨é¡¹ä¸­è¯»å‡ºæ®µé•¿ SL = ${segLength}ï¼ŒåŸºå€ Base = ${segBase}ã€‚`);
        await this.sleep(1000);

        // Step 4: Check offset
        this.log(`å°†æ®µå†…åœ°å€ W (${offset}) ä¸æ®µé•¿ SL (${segLength}) æ¯”è¾ƒ`, step++);
        await this.highlight(segRow, 'highlight-process');
        if (offset >= segLength) {
             this.log(`<span class="text-red-400">é”™è¯¯: æ®µå†…åœ°å€è¶Šç•Œ (W >= SL)ã€‚äº§ç”Ÿè¶Šç•Œä¸­æ–­ã€‚</span>`);
             await this.highlight(segRow, 'highlight-error');
             this.translateBtn.disabled = false;
             return;
        }
        this.log(`æ£€æŸ¥é€šè¿‡ (W < SL)ã€‚`);
        await this.sleep(500);

        // Step 5: Calculate physical address
        const physicalAddress = segBase + offset;
        this.log(`è®¡ç®—ç‰©ç†åœ°å€ = Base + W = ${segBase} + ${offset}`, step++);
        this.log(`<b class="text-green-400">ç‰©ç†åœ°å€ = ${physicalAddress}</b>`);

        this.resultDiv.innerHTML = `<span class="font-bold">æœ€ç»ˆç‰©ç†åœ°å€:</span> <span class="p-2 rounded bg-green-200 text-green-800">${physicalAddress}</span>`;
        this.resultDiv.classList.remove('hidden');
        await this.highlight(this.resultDiv.querySelector('span:last-child'), 'highlight-success');
        
        this.translateBtn.disabled = false;
    }
}


document.addEventListener('DOMContentLoaded', () => {
    const simulator = new SegmentationSimulator();
});
</script>

</body>
</html>
