<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>并发与并行执行示意图</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- The html2canvas script for capturing the diagram -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kDXrdSHZCXKpaA+gHNJwA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .task-a { background-color: #fca5a5; } /* red-300 */
        .task-b { background-color: #86efac; } /* green-300 */
        .task-c { background-color: #93c5fd; } /* blue-300 */
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-4xl bg-white p-6 md:p-8 rounded-xl shadow-lg">
        
        <!-- This is the area that will be captured as an image -->
        <div id="diagram-to-capture">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">图1.1：并发与并行执行示意图</h1>
            
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
                
                <!-- 并发执行 -->
                <div class="flex flex-col items-center">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">并发执行 (Concurrency)</h2>
                    <div class="w-full">
                        <div class="flex items-center mb-3">
                            <span class="font-bold text-gray-600 w-16 shrink-0">单 CPU</span>
                            <div class="flex-1 h-10 bg-gray-200 rounded-md overflow-hidden flex shadow-inner">
                                <div class="h-full task-a text-center text-sm font-medium text-red-800" style="width: 15%; line-height: 2.5rem;">A</div>
                                <div class="h-full task-b text-center text-sm font-medium text-green-800" style="width: 15%; line-height: 2.5rem;">B</div>
                                <div class="h-full task-c text-center text-sm font-medium text-blue-800" style="width: 15%; line-height: 2.5rem;">C</div>
                                <div class="h-full task-a text-center text-sm font-medium text-red-800" style="width: 15%; line-height: 2.5rem;">A</div>
                                <div class="h-full task-b text-center text-sm font-medium text-green-800" style="width: 15%; line-height: 2.5rem;">B</div>
                                <div class="h-full task-c text-center text-sm font-medium text-blue-800" style="width: 15%; line-height: 2.5rem;">C</div>
                                <div class="h-full bg-gray-300 text-center text-xs font-medium text-gray-600" style="width: 10%; line-height: 2.5rem;">...</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                             <span class="font-bold text-gray-600 w-16 shrink-0">时间轴</span>
                             <div class="relative flex-1">
                                <div class="h-0.5 bg-gray-800"></div>
                                <div class="absolute -top-1 left-0 h-2 w-0.5 bg-gray-800"></div>
                                <!-- FIX: Replaced character arrow with a CSS border-based arrow for consistency -->
                                <div class="absolute top-1/2 right-0 w-0 h-0" style="border-top: 4px solid transparent; border-bottom: 4px solid transparent; border-left: 6px solid #1f2937; transform: translateY(-50%);"></div>
                             </div>
                        </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4 text-sm md:text-base">一个处理器在多个任务间快速切换，造成同时执行的<span class="font-semibold">假象</span>。</p>
                </div>

                <!-- 并行执行 -->
                <div class="flex flex-col items-center">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">并行执行 (Parallelism)</h2>
                    <div class="w-full space-y-3">
                        <div class="flex items-center">
                            <span class="font-bold text-gray-600 w-16 shrink-0">CPU 1</span>
                            <div class="flex-1 h-10 bg-gray-200 rounded-md overflow-hidden flex shadow-inner">
                                <div class="h-full task-a flex items-center justify-center text-sm font-medium text-red-800 w-full">程序 A</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="font-bold text-gray-600 w-16 shrink-0">CPU 2</span>
                            <div class="flex-1 h-10 bg-gray-200 rounded-md overflow-hidden flex shadow-inner">
                                 <div class="h-full task-b flex items-center justify-center text-sm font-medium text-green-800 w-full">程序 B</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="font-bold text-gray-600 w-16 shrink-0">CPU 3</span>
                            <div class="flex-1 h-10 bg-gray-200 rounded-md overflow-hidden flex shadow-inner">
                                 <div class="h-full task-c flex items-center justify-center text-sm font-medium text-blue-800 w-full">程序 C</div>
                            </div>
                        </div>
                         <div class="flex items-center">
                             <span class="font-bold text-gray-600 w-16 shrink-0">时间轴</span>
                             <div class="relative flex-1">
                                <div class="h-0.5 bg-gray-800"></div>
                                <div class="absolute -top-1 left-0 h-2 w-0.5 bg-gray-800"></div>
                                <!-- FIX: Replaced character arrow with a CSS border-based arrow for consistency -->
                                <div class="absolute top-1/2 right-0 w-0 h-0" style="border-top: 4px solid transparent; border-bottom: 4px solid transparent; border-left: 6px solid #1f2937; transform: translateY(-50%);"></div>
                             </div>
                        </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4 text-sm md:text-base">多个处理器在同一时刻<span class="font-semibold">真正地</span>同时执行多个任务。</p>
                </div>
            </div>
            
            <!-- 图例 -->
            <div class="flex justify-center items-center space-x-6 mt-10 pt-6 border-t">
                <div class="flex items-center">
                    <div class="w-5 h-5 rounded task-a mr-2"></div>
                    <span class="text-sm text-gray-700">程序 A</span>
                </div>
                <div class="flex items-center">
                    <div class="w-5 h-5 rounded task-b mr-2"></div>
                    <span class="text-sm text-gray-700">程序 B</span>
                </div>
                <div class="flex items-center">
                    <div class="w-5 h-5 rounded task-c mr-2"></div>
                    <span class="text-sm text-gray-700">程序 C</span>
                </div>
            </div>
        </div>

        <!-- Download Button and Logic -->
        <div class="text-center mt-8 pt-6 border-t border-gray-200">
            <button id="download-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 ease-in-out transform hover:scale-105">
                下载为图片 (.png)
            </button>
        </div>
    </div>

    <script>
        // --- Download Functionality ---
        // We wrap the entire logic in window.onload to ensure all resources (like fonts) are loaded before we attach the event listener.
        window.onload = function() {
            document.getElementById('download-btn').addEventListener('click', function() {
                const captureElement = document.getElementById('diagram-to-capture');
                const button = this;

                // Optional: Show a loading state on the button
                button.textContent = '正在生成...';
                button.disabled = true;

                html2canvas(captureElement, {
                    // Options to improve quality
                    scale: 2, // Renders at a higher resolution
                    useCORS: true, // Important for loading external assets like Google Fonts
                    backgroundColor: '#ffffff' // Set a white background for the captured image
                }).then(canvas => {
                    // Convert the canvas to a PNG image data URL
                    const imageUrl = canvas.toDataURL('image/png', 1.0);

                    // Create a temporary link element to trigger the download
                    const link = document.createElement('a');
                    link.href = imageUrl;
                    link.download = '并发与并行执行示意图.png'; // The filename for the downloaded image
                    
                    // Append to the body, click, and then remove
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Restore button state
                    button.textContent = '下载为图片 (.png)';
                    button.disabled = false;

                }).catch(err => {
                    console.error("错误：无法生成图片。", err);
                    // Use a more user-friendly error message without alert()
                    button.textContent = '下载失败，请重试';
                    button.disabled = false; // Re-enable button on failure
                });
            });
        };
    </script>
</body>
</html>
